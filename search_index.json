[["index.html", "Découvrir R et RStudio Chapitre 1 Introduction 1.1 Le parcours de formation 1.2 Objectifs du module 1", " Découvrir R et RStudio Thierry Zorn, Murielle Lethrosne, Vivien Roussez, Pascal Irz &amp; Nicolas Torterotot 22 June 2022 Chapitre 1 Introduction Crédit photographique Pascal Boulin 1.1 Le parcours de formation Ce dispositif de formation vise à faire monter en compétence les agents du MTECT (Ministère de la Transition écologique et de la Cohésion des territoires) et du MTE (Ministère de la Transition énergétique) dans le domaine de la science de la donnée avec le logiciel R. Il est conçu pour être déployé à l’échelle nationale par le réseau des CVRH (Centre de Valorisation des Ressources Humaines). Le parcours proposé est structuré en modules de 2 jours chacun. Avoir suivi les deux premiers (ou disposer d’un niveau équivalent) est un pré-requis pour suivre les suivants qui sont proposés “à la carte” : Module 1 : Socle - Premier programme en R Module 2 : Socle - Préparation des données Module 3 : Statistiques descriptives Module 4 : Analyse des données multi-dimensionnelles Module 5 : Datavisualisation : Produire des graphiques, des cartes et des tableaux Module 6 : Publications reproductibles avec RMarkdown (à venir) Module 7 : Analyse spatiale Module 8 : Big data et optimisation du code (à venir) Module 9 : Applications interactives avec RShiny (à venir) La mise à disposition des supports de formation se fait désormais par la page d’accueil du parcours de formation. Ces supports sont en licence ouverte. Si vous souhaitez accéder aux sources ou aux données mobilisées pendant les formations, il faut directement les télécharger depuis le Github du pôle ministériel. Un package d’exercices, {savoirfR} rassemble toutes les données et les consignes d’exercices de ce parcours de formation (Modules 1, 2 et 5 seulement pour l’instant). Pour vous tenir au courant de l’offre de formation proposée par le réseau des CVRH, consultez la plateforme OUPS (un accès intranet MTECT-MTE est nécessaire). Vous pouvez vous y abonner pour recevoir les annonces de formation qui vous intéressent. Pour échanger de l’information, discuter autour de R ou encore faire part de difficultés et trouver ensemble les solutions, il existe deux canaux d’entraide : s’inscrire en envoyant un message vide à l’adresse sympa@developpement-durable.gouv.fr ; rejoindre le fil Ariane #utilisateurs_r. 1.2 Objectifs du module 1 Ce module vise à faire découvrir : R et son écosystème. L’interface de RStudio. Les méthodes élémentaires d’importation des données Des premières statistiques Des premières représentations graphiques Il s’agit d’avoir les clefs pour commencer à travailler rapidement sur R en complément, voire en remplacement d’autres outils (Excel, SAS…). Les concepts de programmation sont également abordés pour comprendre les syntaxes proposées dans les différents forums d’aide. "],["r-son-écosystème-et-ses-possibilités.html", "Chapitre 2 R, son écosystème et ses possibilités 2.1 Le groupe de référents R du pôle ministériel 2.2 R c’est quoi ? 2.3 Un peu d’histoire 2.4 Un logiciel libre 2.5 Que peut-on faire avec R ? 2.6 Un logiciel modulaire 2.7 Des exemples de ce qu’on peut faire avec R :", " Chapitre 2 R, son écosystème et ses possibilités 2.1 Le groupe de référents R du pôle ministériel Un groupe pour structurer une offre de formations sur R Un réseau d’entraide 2.2 R c’est quoi ? Un langage de programmation interprété exécutable pas à pas \\(\\rightarrow\\) lignes de code Un logiciel interactif permettant de traiter divers types de données 2.3 Un peu d’histoire À l’origine existait le langage S, servant à programmer avec des données (Bell laboratory, années 70) Au milieu des années 90, mélange de S et du langage Lisp pour le dédier à l’analyse de données et aux graphiques \\(\\rightarrow\\) création de R. Ihaka R, Gentleman R (1996) R: A Language for Data Analysis and Graphics. Journal of Computational and Graphical Statistics, 5(3), 299–314 S’est d’abord développé dans le monde académique, puis a essaimé vers d’autres domaines professionnels, voire associatifs Système toujours d’actualité - Mise à jour tous les 6 mois Avenir dans la statistique publique : adopté comme standard par l’Insee (à l’horizon 2025) et divers SSM. Des packages pour : charger les données produites par l’Insee au format sdmx, charger les formats des organisations internationales (Eurostat, OCDE, ONU, etc.), charger des couches spatiales shp ou autres, charger le cadastre au format EDIGEO, … interroger facilement des API, interagir avec des bases de données, charger des fonds de cartes, réaliser des publications conformes à la charte graphique de l’Etat, gérer les millésimes du référentiel communal, etc. 2.4 Un logiciel libre Disponible en libre téléchargement sur le site officiel du CRAN = Comprehensive R Archive Network C’est le site de référence pour R. Il contient non seulement les installeurs du logiciel mais également de nombreuses ressources : documentations, FAQ, tutoriels… Installable sur la plupart des systèmes d’exploitation Utilisé en recherche, en enseignement et en entreprise Une communauté très active : Forum des utilisateurs de R en français Communauté française des utilisateurs de R (avec des packages spécifiques, qui permettent de gérer les changements de géographie communale par exemple) : Frrrenchies Slack de ces utilisateurs (pour les questions/réponses, actualités…) Slack R-bloggers : https://www.r-bloggers.com/ Stackoverflow : https://stackoverflow.com/questions/tagged/r C’est un logiciel libre : les utilisateurs ont la liberté d’exécuter, copier, distribuer, étudier, modifier et améliorer ce logiciel. R fait partie de la “galaxie” GNU (GNU’s Not Unix). R est donc libre, gratuit et multi-plateformes. 2.5 Que peut-on faire avec R ? Lire des données de formats divers Les manipuler (prétraitements) Les enrichir à partir de données externes Les analyser, les modéliser, Présenter les résultats (tableaux, graphiques, cartes) Publier… … et ce au moyen d’une palette de méthodes extrêmement diversifiée. Privilégie la flexibilité et le découpage des traitements en parties simples. 2.6 Un logiciel modulaire Le package base contient nombreuses fonctionnalités Extensible au moyen de packages (1 package = 1 ensemble de nouvelles fonctions) Nombreuses extensions spécialisées De base, R permet déjà de faire un très grand nombre de choses avec son socle commun : le package base. Pour afficher la liste des fonctions disponibles dans le package base : library(help = &#39;base&#39;) Sur ce package base vient se greffer un ensemble de packages (plugins, modules) complémentaires. Un package est une bibliothèque de fonctions. La plupart de ceux qui font référence sont mis à disposition de tous sur le dépôt CRAN. Cela permet d’étendre à l’infini les possibilités de R : celles-ci sont seulement limitées par la volonté de développement (et de maintien) des utilisateurs. De même que les packages sont dépendants de fonctions du module principal base, certains packages peuvent être dépendants de fonctionnalités d’autres packages \\(\\rightarrow\\) notion d’arbre des dépendances (géré par R de façon transparente). Structure modulaire \\(\\rightarrow\\) il existe de multiples façons d’effectuer une même tâche. Il suffit d’une méthode maîtrisée pour aller au résultat. Les fonctionnalités utilisables dans R, sont en perpétuelle évolution et permettent d’intégrer les méthodes les plus récentes dans des domaines qui évoluent rapidement : modélisation, analyse spatiale, dataviz,… Le groupe des référents R propose un tutoriel d’installation et de configuration de R sur https://github.com/MTES-MCT/parcours-r/wiki/Installation-de-R-et-RStudio-Desktop-au-MTE. 2.7 Des exemples de ce qu’on peut faire avec R : Le support de cette formation Les publications régionales sur le parc locatif social Visualisation du compte du logement Les pesticides dans les cours d’eau des Pays de la Loire Des exemples de ce qu’on peut faire avec shiny "],["présentation-de-linterface-et-premières-manipulations.html", "Chapitre 3 Présentation de l’interface et premières manipulations 3.1 Une interface dédiée : RStudio 3.2 Session et répertoire de travail 3.3 C’est à vous : créer un répertoire de travail 3.4 Prise en main de la console 3.5 Création d’une variable 3.6 C’est à vous : créer et manipuler des variables 3.7 Utilité des scripts 3.8 C’est à vous : utiliser un script 3.9 Installer et charger un package", " Chapitre 3 Présentation de l’interface et premières manipulations Ce chapitre permet de découvrir l’interface de travail RStudio et les principales fonctionnalités pour débuter. 3.1 Une interface dédiée : RStudio Environnement de développement conçu spécialement pour R Interface utilisateur simple, conviviale, configurable et intégrant plusieurs outils Disponible sur http://www.rstudio.com L’interface RStudio est composée de différents panneaux, dont l’arrangement peut être reconfiguré, incluant une console, un navigateur de fichiers et graphiques, l’espace de travail et l’historique des commandes. D’autres environnements graphiques existent, Rstudio semble le plus approprié à nos métiers. 3.2 Session et répertoire de travail Session de travail R : commence à l’ouverture de RStudio et se termine en le quittant. Répertoire de travail R : dossier dans lequel le logiciel va chercher les fichiers de scripts et de données. Tout ce qui a été fait au cours d’une session peut être enregistré dans le répertoire de travail : données historique des fonctions … Nouvelles fonctions Attention setwd() pour définir un répertoire de travail Seulement / et pas \\ help() et ? pour afficher l’aide . dir() pour lister un répertoire . Attention avec le répertoire de travail : si on l’écrit en dur setwd('...'), les anti-slash windows (\\) doivent être remplacés par des slash(/) Concernant le répertoire de travail, quelques conseils : Créer un nouveau répertoire pour un projet particulier qui sera votre répertoire de travail Créer des sous-répertoires dans ce répertoire : “./Data,” “./Figures,” “./Redaction”… Rassembler autant que possible les fichiers qui seront utilisés dans le cadre de ce projet et éviter d’aller chercher des fichiers ailleurs (sauf à inscrire dans le script une instruction de téléchargement exécutable par tous) 3.3 C’est à vous : créer un répertoire de travail Sur le poste de travail, créer un dossier ‘premiers_pas’ à partir du menu ‘New Folder’ (cadran droite bas) Dans Rstudio, définir ce dossier comme répertoire de travail directement en utilisant setwd('') Appeler l’aide en ligne par ?setwd ou help(setwd) Faire une recherche dans la partie Help de RStudio Créer un script à partir du menu ‘File/New File/R script’ et l’enregistrer sous ‘mes_tous_premiers_pas.R’ Lire le contenu du répertoire de travail avec dir() 3.4 Prise en main de la console Effectuer et afficher les résultats de calculs de base (+, -, *, /, ^, ...) Utiliser des fonctions spécifiques : sum, abs, round… On peut remonter dans l’historique des fonctions pour en rappeler une Nouvelles fonctions Attention sum() pour sommer un résultat Séparateur décimal point (.) abs() pour retourner la valeur absolue . round() pour arrondir un nombre . flèches pour naviguer dans l’historique . 3.5 Création d’une variable On assigne un contenu à une variable au moyen de &lt;- La flèche d’assignation peut être écrite avec le raccourci clavier alt + “-” (tiret du 6). ma_variable &lt;- 2 ma_variable &lt;- &quot;Toulouse&quot; ma_variable &lt;- c(&quot;Toulouse&quot;, &quot;Nantes&quot;, &quot;Strasbourg&quot;) ma_variable &lt;- 1:10 \\(\\rightarrow\\) Les variables peuvent être numériques, de type texte ou booléen (TRUE/FALSE) et elles peuvent être réutilisées. Nouvelles fonctions Attention pour le nommage des variables ls() pour faire lister les variables existantes Casse -&gt; seulement minuscules paste() pour concaténer des variables textes Pas de caractères spéciaux ni accentués rm() pour supprimer une variable Pas d’espaces ni tirets (-) ; préférer (_) Adopter des règles de nommage cohérentes, par exemples celles-ci. ATTENTION : un nom de variable ne peux pas commencer par un chiffre et certains noms sont interdits (voir 4.6) 3.6 C’est à vous : créer et manipuler des variables Créer plusieurs variables numériques par assignation a &lt;- 5, b &lt;- 4 Regarder l’onglet Environnement Afficher la liste des variables avec la fonction ls() Faire un calcul avec ces variables et voir le résultat (a+b) etc. Créer une troisième variable à partir des deux premières c &lt;- a+b*3 Ré-assigner une variable : a&lt;-10 et vérifier l’onglet environnement Créer une variable chaîne de caractère (utilisation des simples quotes et des double-quotes) t &lt;- 'chaine' Concaténer a et t avec paste(a,t) Expérimenter la casse des noms de variables : créer A &lt;- 15 et B &lt;- 12 et vérifier l’onglet environnement Supprimer les variables A et B avec la fonction rm() Aide en ligne ?ls et ?rm Attention : Pour supprimer toutes les variables rm(list = ls()) 3.7 Utilité des scripts Garder la trace d’une longue succession de lignes de code Pouvoir exécuter ce code (pas à pas ou en entier) Le modifier plus rapidement pour l’adapter Pouvoir le réutiliser avec de nouvelles données Nouvelles fonctions Attention # pour des commentaires explicatifs du code Importance de bien commenter print() pour afficher sur la console . Ctrl+Entrée pour lancer un script ligne par ligne . Utilisation simple de R \\(\\rightarrow\\) mode console. Chaque ordre, bout de code est rentré et exécuté au fur et à mesure sur la console. Actions plus complexes, longues, nécessitant une maintenance, des modifications \\(\\rightarrow\\) travailler à partir de la fenêtre éditeur. Les parties de code sont enchaînées et enregistrées sous la forme d’un fichier texte réutilisable par la suite. Toujours utiliser des commentaires. Permet de pouvoir mieux comprendre ce que l’on a fait lorsqu’on reprend un programme plus tard ou lorsqu’on le donne à quelqu’un. 3.8 C’est à vous : utiliser un script Recopier le script ci-dessous et changer les paramètres pour le re-exécuter plusieurs fois Sauvegarder ce script dans votre répertoire de travail, fermez le Redémarrer votre session RStudio, le rouvrir, et ré-exécuter le script # Supprimer toutes les variables existantes rm(list = ls()) # Création de mes variables taille et poids ; attention au point décimal poids &lt;- 91 taille &lt;- 1.87 # Calcul de l&#39;IMC : poids sur taille au carré imc &lt;- poids / (taille ^ 2) # Affichage du résultat print (imc) ## [1] 26.02305 3.9 Installer et charger un package Pour manipuler notre base de données, nous allons nous servir de fonctionnalités présentes dans le package tidyverse. La première fois que l’on veut utiliser un package, il faut le télécharger sur notre machine, avec install.packages() : install.packages(&quot;tidyverse&quot;) Puis à l’ouverture d’une nouvelle session R, le charger (si on a besoin de ses fonctions), avec library() : library(tidyverse) Le package est prêt à être utilisé ! Pour appliquer une fonction à un objet, la syntaxe est : nom_de_la_fonction(objet, attribut1, attribut2, ...) Pour stocker le résultat de cette fonction dans une variable : ma_variable &lt;- nom_de_la_fonction(objet, attribut1, attribut2, ...) Une erreur fréquente est : Error in nom_de_le_fonction() : impossible de trouver la fonction \"nom_de_la_fonction\" Cela signifie que le package auquel appartient la fonction n’est pas chargé, voire pas installé. Il peut exister des fonctions homonymes dans différents packages. Sans précision, la fonction qui sera appliquée sera celle du package chargé en dernier. Pour spécifier : nom_du_package::nom_de_la_fonction(objet) "],["bien-commencer.html", "Chapitre 4 Bien commencer 4.1 Créer un projet sous Rstudio pour vous permettre de recenser vos travaux. 4.2 Utilisation du package {savoirfR} 4.3 Intégrer vos données 4.4 Créer votre arborescence de projet 4.5 Activer les packages nécessaires 4.6 Bien structurer ses projets data", " Chapitre 4 Bien commencer 4.1 Créer un projet sous Rstudio pour vous permettre de recenser vos travaux. Pourquoi travailler avec les projets Rstudio plutôt que les scripts R ? Cela permet la portabilité : le répertoire de travail par défaut d’un projet est le répertoire où est ce projet. Si vous transmettez celui-ci à un collègue, le fait de lancer un programme ne dépend pas de l’arborescence de votre machine. Fini les setwd(\"chemin/qui/marche/uniquement/sur/mon/poste\") ! Toujours sur la portabilité, un projet peut être utilisé avec un outil comme renv qui va vous intégrer en interne au projet l’ensemble des packages nécessaires au projet. Cela permet donc à votre collègue à qui vous passez votre projet de ne pas avoir à les installer et, surtout, si vous mettez à jour votre environnement R, votre projet restera toujours avec les versions des packages avec lesquelles vous avez fait tourner votre projet à l’époque. Cela évite d’avoir à subir les effets d’une mise à jour importante d’un package qui casserait votre code. Pour activer renv sur un projet, il faut l’installer avec install.packages(\"renv\"). Pour intialiser la sauvegarde des packages employés dans le projet, il faut utiliser renv::init() Les packages chargés dans le projet sont enregistrés dans un sous-dossier dédié. En cours de travail sur le projet, la commande renv::snapshot() permet de faire une sauvegarde, la commande renv::restore() permet de charger la dernière sauvegarde. En savoir plus sur renv Cela permet de se forcer à travailler en mode projet : on intègre à un seul endroit tout ce qui est lié à un projet : données brutes, données retravaillées, scripts, illustrations, documentations, publications… et donc y compris les packages avec renv. On peut travailler sur plusieurs projets en même temps, Rstudio ouvre autant de sessions que de projets dans ce cas. Les projets Rstudio intègrent une interface avec les outils de gestion de version Git et SVN. Cela veut dire que vous pouvez versionner votre projet et l’héberger simplement comme répertoire sur des plateformes de gestion de code telle que Github ou Gitlab. Pour créer un projet : Cliquez sur Project en haut à droite puis New Project. Cliquez sur New Directory. 4.2 Utilisation du package {savoirfR} Pour faciliter le déroulé de ce module, l’ensemble des exercices (énoncés, corrigés et données) a été intégré à un package réalisé par le groupe des référents R : {savoirfR} install.packages(&#39;remotes&#39;) remotes::install_github(&quot;MTES-MCT/savoirfR&quot;) Pour l’utiliser, il suffit de créer un nouveau projet dans un nouveau répertoire, en sélectionnant le “Project Type” Exercice Parcours R MTES-MCT. Remplissez et sélectionnez le module suivi. 4.3 Intégrer vos données Une bonne pratique est de créer un sous répertoire /data pour stocker les données sur lesquelles vous aurez à travailler. Vous pouvez le faire depuis l’explorateur de fichier de votre système d’exploitation ou directement à partir de l’explorateur de fichier de RStudio. Cela marche bien quand on a un seul type de données, mais en général on va avoir à travailler sur des données brutes que l’on va retravailler ensuite et vouloir stocker à part. Si par la suite vous souhaitez avoir des exemples de bonnes pratiques sur comment structurer vos données, vous pouvez vous référer au chapitre data du livre d’Hadley Wickham sur la construction de packages R (tout package R étant aussi un projet !). 4.4 Créer votre arborescence de projet Créer un répertoire /src ou vous mettrez vos scripts R. Créer un répertoire /figures ou vous mettrez vos illustrations issues de R. 4.5 Activer les packages nécessaires Commencer par rajouter un script dans le répertoire /src à votre projet qui commencera par : activer l’ensemble des packages nécessaires charger les données dont vous aurez besoin. library(tidyverse) library(GGally) library(plotly) base &lt;- read.csv(file = &quot;extdata/Base_synth_territoires.csv&quot;, header = TRUE, sep = &quot;;&quot;, dec = &quot;,&quot;) 4.6 Bien structurer ses projets data Plusieurs documents peuvent vous inspirer sur la structuration de vos projets data par la suite. En voici quelques uns : https://github.com/pavopax/new-project-template https://nicercode.github.io/blog/2013-04-05-projects/ https://www.inwt-statistics.com/read-blog/a-meaningful-file-structure-for-r-projects.html http://projecttemplate.net/architecture.html À partir du moment où quelques grands principes sont respectés (un répertoire pour les données brutes en lecture seule par exemple), le reste est surtout une question d’attirance plus forte pour l’une ou l’autre solution. L’important est de vous tenir ensuite à conserver toujours la même arborescence dans vos projets afin de vous y retrouver plus simplement. "],["mon-premier-jeu-de-données.html", "Chapitre 5 Mon premier jeu de données 5.1 Les types de valeurs dans R 5.2 Les vecteurs 5.3 Les dataframes 5.4 Les fonctions et les valeurs particulières 5.5 Importation de données 5.6 Gérer le type des variables 5.7 Structure des données : le dataframe 5.8 Exercice 2 : importer des données et premier coup d’oeil 5.9 Catalogue d’attributs de la base", " Chapitre 5 Mon premier jeu de données 5.1 Les types de valeurs dans R Une valeur constitue l’unité de base des données pour R. Comme pour la plupart des logiciels, elles peuvent être de trois types : Numérique : entier, double Caractère : texte ou code Logique : booléens En anglais : numeric, character et logical ! Les formats de dates sont de type character. 5.2 Les vecteurs Les valeurs peuvent être structurées au sein de vecteurs. Ces vecteurs peuvent être vus comme des colonnes de valeurs toutes du même type. Différentes fonctions permettent de créer des vecteurs. vect_num &lt;- c(1, 160, 2, 9) vect_txt &lt;- c(&quot;Je&quot;, &quot;programme&quot;, &quot;en&quot;, &quot;R&quot;) sequence &lt;- seq(from = 1, to = 10, by = 1) sequence_pareille &lt;- 1:10 repetition &lt;- rep(&quot;bla&quot;, 3) 5.3 Les dataframes Plusieurs vecteurs de types différents possédant un même nombre de lignes peuvent être accolés pour former une dataframe. Les dataframes sont les objets les plus courants dans le traitement de données usuel. Il s’agit de tableaux dont les lignes correspondent à des observations et les colonnes à des variables. Ces dataframes peuvent être créées par association des vecteurs avec les fonctions : dataframe_a &lt;- data.frame(vect_num, vect_txt) dataframe_b &lt;- bind_cols(&quot;vect_num&quot; = vect_num, &quot;vect_txt&quot; = vect_txt) Une dataframe peut aussi être créée par l’import d’un tableau, voir le chapitre dédié. Il est possible d’accéder aux éléments d’une dataframe à partir du numéro de ligne et de colonne, grâce aux crochets : base[1,3] \\(\\rightarrow\\) valeur de la première ligne et de la troisième colonne base[2,] \\(\\rightarrow\\) toutes les variables pour la 2e observation base[,4] \\(\\rightarrow\\) toutes les observations de la quatrième colonne base[,’V6’] \\(\\rightarrow\\) toutes les observations de la variable V6 \\(\\Rightarrow\\) Utile pour sélectionner une partie d’une table : base[1:4, c(3, 6)] 5.4 Les fonctions et les valeurs particulières NA : valeur manquante (Not Available) dans une dataframe ou en résultat d’une fonction NaN : pas un nombre (Not a Number) lorsqu’une fonction tente de diviser par 0 -Inf, Inf : inﬁni positif ou négatif lorsque une fonction diverge Une valeur manquante peut perturber l’exécution d’une fonction : V1 &lt;- c(1, 14, NA, 32.7) mean(V1) # renvoie NA. Not good ! ## [1] NA mean(V1, na.rm = TRUE) # renvoie 15.9 - OK ! ## [1] 15.9 Les noms de ces valeurs particulières sont “réservés” par R, ils ne peuvent pas être utilisés comme nom de variable. C’est également le cas des booléens (TRUE, FALSE, T et F) \\(\\Rightarrow\\) Le module 2 “Préparation des données” aborde la gestion de ces valeurs particulières. 5.5 Importation de données Conseil : exporter les données au format CSV ; c’est le format le plus interopérable (supporté par tous les logiciels stat). Utiliser ensuite la fonction read.csv après avoir défini le répertoire de travail (ou en donnant le chemin complet) base0 &lt;- read.csv(file = &quot;extdata/Base_synth_territoires.csv&quot;, header = TRUE, sep = &quot;;&quot;, dec = &quot;,&quot;) header =indique la présence des noms de variable sur la première ligne sep = indique le séparateur de champ : ‘;’ ‘/t’ pour tabulation dec = indique le séparateur de décimale (‘.’ par défaut) colClasses =permet de préciser le type de chaque colonne de la donnée en entrée, par exemple pour une table de 3 colonnes de types texte, puis 2 fois numériques : colClasses = c(\"character\", \"numeric\", \"numeric\"). NA pour laisser R deviner, NULL pour éviter d’importer la colonne. \\(\\Rightarrow\\) ?read.csv pour plus d’options Autres façons d’importer les données Fonction read_delim, du package readr, plus rapide Fonction fread, du package data.table, beaucoup plus rapide !! Pour importer les fichiers XLS, ODT ou DBF, il existe des fonctions et des packages spécifiques Le passage par un fichier csv est très recommandé 5.6 Gérer le type des variables Chaque variable est du type de son contenu (numeric, character, logical). Si les valeurs prises par la variables correspondent à un nombre fini de modalités, la variable peut être du type “factor”. Ses composantes sont toujours d’un des 3 types décrits ci-dessus mais il est possible d’employer des fonctions spécifiques au traitement de modalités. À chaque type de variable correspond une utilisation. Lors de l’import des données, un type est affecté automatiquement par R. Mais le type peut être erroné. Il suffit alors de les convertir : base &lt;- mutate(base0, LIBGEO = as.character(LIBGEO)) ou as.factor(), as.numeric(), etc… Pour être sûr de ne pas faire de bêtise, il vaut mieux gérer les types au moment de l’importation avec le paramètre colClasses \\(\\rightarrow\\) exercice ! 5.7 Structure des données : le dataframe n lignes (observations) p colonnes (variables) Les fonctions suivantes permettent de connaître la structure de la dataframe, d’en connaître les variables, d’en observer certaines lignes ou d’en vérifier le type. nrow(base) # nombre de lignes ## [1] 36689 ncol(base) # nombre de colonnes ## [1] 38 dim(base) # nombre de lignes et de colonnes ## [1] 36689 38 names(base) # noms des variables ## [1] &quot;CODGEO&quot; &quot;LIBGEO&quot; &quot;REG&quot; &quot;DEP&quot; ## [5] &quot;ZAU&quot; &quot;ZE&quot; &quot;P14_POP&quot; &quot;P09_POP&quot; ## [9] &quot;SUPERF&quot; &quot;NAIS0914&quot; &quot;DECE0914&quot; &quot;P14_MEN&quot; ## [13] &quot;NAISD15&quot; &quot;DECESD15&quot; &quot;P14_LOG&quot; &quot;P14_RP&quot; ## [17] &quot;P14_RSECOCC&quot; &quot;P14_LOGVAC&quot; &quot;P14_RP_PROP&quot; &quot;NBMENFISC13&quot; ## [21] &quot;PIMP13&quot; &quot;MED13&quot; &quot;TP6013&quot; &quot;P14_EMPLT&quot; ## [25] &quot;P14_EMPLT_SAL&quot; &quot;P09_EMPLT&quot; &quot;P14_POP1564&quot; &quot;P14_CHOM1564&quot; ## [29] &quot;P14_ACT1564&quot; &quot;ETTOT14&quot; &quot;ETAZ14&quot; &quot;ETBE14&quot; ## [33] &quot;ETFZ14&quot; &quot;ETGU14&quot; &quot;ETGZ14&quot; &quot;ETOQ14&quot; ## [37] &quot;ETTEF114&quot; &quot;ETTEFP1014&quot; str(base) # nom, type et extrait des variables ## &#39;data.frame&#39;: 36689 obs. of 38 variables: ## $ CODGEO : chr &quot;01001&quot; &quot;01002&quot; &quot;01004&quot; &quot;01005&quot; ... ## $ LIBGEO : chr &quot;L&#39;Abergement-Cl\\xe9menciat&quot; &quot;L&#39;Abergement-de-Varey&quot; &quot;Amb\\xe9rieu-en-Bugey&quot; &quot;Amb\\xe9rieux-en-Dombes&quot; ... ## $ REG : int 84 84 84 84 84 84 84 84 84 84 ... ## $ DEP : chr &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; ... ## $ ZAU : chr &quot;120 - Multipolaris\\xe9e des grandes aires urbaines&quot; &quot;112 - Couronne d&#39;un grand p\\xf4le&quot; &quot;112 - Couronne d&#39;un grand p\\xf4le&quot; &quot;112 - Couronne d&#39;un grand p\\xf4le&quot; ... ## $ ZE : chr &quot;8213 - Villefranche-sur-Sa\\xf4ne&quot; &quot;8201 - Amb\\xe9rieu-en-Bugey&quot; &quot;8201 - Amb\\xe9rieu-en-Bugey&quot; &quot;8213 - Villefranche-sur-Sa\\xf4ne&quot; ... ## $ P14_POP : int 767 239 14022 1627 109 2570 743 338 1142 397 ... ## $ P09_POP : int 787 207 13350 1592 120 2328 660 336 960 352 ... ## $ SUPERF : num 15.95 9.15 24.6 15.92 5.88 ... ## $ NAIS0914 : int 40 16 1051 117 8 175 59 12 56 25 ... ## $ DECE0914 : int 25 7 551 41 3 78 20 11 32 10 ... ## $ P14_MEN : num 306 99.3 6161.1 621.1 52.5 ... ## $ NAISD15 : int 13 5 222 15 2 21 11 2 18 4 ... ## $ DECESD15 : int 5 1 121 7 2 9 3 3 5 0 ... ## $ P14_LOG : num 342.7 161.2 6838.4 661.8 71.5 ... ## $ P14_RP : num 306 99.3 6161.1 621.1 52.5 ... ## $ P14_RSECOCC : num 14 47.3 121.6 10.9 10.9 ... ## $ P14_LOGVAC : num 22.74 14.55 555.64 29.85 8.14 ... ## $ P14_RP_PROP : num 260 84.6 2769 473.3 37.7 ... ## $ NBMENFISC13 : int 297 99 6034 617 47 1014 299 140 431 137 ... ## $ PIMP13 : num NA NA 57.4 NA NA ... ## $ MED13 : num 22130 23213 19554 22388 21872 ... ## $ TP6013 : num NA NA 15.1 NA NA ... ## $ P14_EMPLT : num 85.16 12.81 7452.93 280.57 5.95 ... ## $ P14_EMPLT_SAL: num 52.19 4.95 6743.37 206.38 3.96 ... ## $ P09_EMPLT : num 65.57 17.64 7551.68 286.61 5.29 ... ## $ P14_POP1564 : num 463 141.6 8962.8 1043.1 71.3 ... ## $ P14_CHOM1564 : num 33 9.84 1059.73 66.33 7.93 ... ## $ P14_ACT1564 : num 376 121 6681.9 842.1 57.5 ... ## $ ETTOT14 : int 47 22 1316 141 7 203 66 39 54 36 ... ## $ ETAZ14 : int 9 1 7 14 0 21 2 5 5 6 ... ## $ ETBE14 : int 2 3 60 7 0 18 0 2 6 4 ... ## $ ETFZ14 : int 5 1 131 19 0 21 9 1 13 3 ... ## $ ETGU14 : int 25 14 892 85 5 114 45 27 24 18 ... ## $ ETGZ14 : int 6 4 283 19 1 28 16 6 9 7 ... ## $ ETOQ14 : int 6 3 226 16 2 29 10 4 6 5 ... ## $ ETTEF114 : int 9 2 385 27 0 38 17 6 9 7 ... ## $ ETTEFP1014 : int 0 0 109 5 0 15 2 0 3 0 ... head(base) # 6 premières lignes ## CODGEO LIBGEO REG DEP ## 1 01001 L&#39;Abergement-Cl\\xe9menciat 84 01 ## 2 01002 L&#39;Abergement-de-Varey 84 01 ## 3 01004 Amb\\xe9rieu-en-Bugey 84 01 ## 4 01005 Amb\\xe9rieux-en-Dombes 84 01 ## 5 01006 Ambl\\xe9on 84 01 ## 6 01007 Ambronay 84 01 ## ZAU ## 1 120 - Multipolaris\\xe9e des grandes aires urbaines ## 2 112 - Couronne d&#39;un grand p\\xf4le ## 3 112 - Couronne d&#39;un grand p\\xf4le ## 4 112 - Couronne d&#39;un grand p\\xf4le ## 5 300 - Autre commune multipolaris\\xe9e ## 6 112 - Couronne d&#39;un grand p\\xf4le ## ZE P14_POP P09_POP SUPERF NAIS0914 DECE0914 ## 1 8213 - Villefranche-sur-Sa\\xf4ne 767 787 15.95 40 25 ## 2 8201 - Amb\\xe9rieu-en-Bugey 239 207 9.15 16 7 ## 3 8201 - Amb\\xe9rieu-en-Bugey 14022 13350 24.60 1051 551 ## 4 8213 - Villefranche-sur-Sa\\xf4ne 1627 1592 15.92 117 41 ## 5 8216 - Chamb\\xe9ry 109 120 5.88 8 3 ## 6 8201 - Amb\\xe9rieu-en-Bugey 2570 2328 33.55 175 78 ## P14_MEN NAISD15 DECESD15 P14_LOG P14_RP P14_RSECOCC P14_LOGVAC ## 1 306.00000 13 5 342.73473 306.00000 13.99418 22.740550 ## 2 99.33745 5 1 161.16023 99.33745 47.27625 14.546538 ## 3 6161.06200 222 121 6838.35437 6161.06200 121.64795 555.644416 ## 4 621.05374 15 7 661.76017 621.05374 10.85505 29.851387 ## 5 52.51818 2 2 71.51818 52.51818 10.85714 8.142857 ## 6 1028.00000 21 9 1160.00000 1028.00000 56.00000 76.000000 ## P14_RP_PROP NBMENFISC13 PIMP13 MED13 TP6013 P14_EMPLT P14_EMPLT_SAL ## 1 260.00000 297 NA 22130.00 NA 85.157286 52.191539 ## 2 84.58436 99 NA 23213.00 NA 12.814642 4.946329 ## 3 2769.00170 6034 57.41294 19554.00 15.11508 7452.926728 6743.374287 ## 4 473.32736 617 NA 22387.62 NA 280.569953 206.382233 ## 5 37.65455 47 NA 21871.67 NA 5.945455 3.963636 ## 6 779.00000 1014 62.35178 21650.67 NA 487.730918 372.758450 ## P09_EMPLT P14_POP1564 P14_CHOM1564 P14_ACT1564 ETTOT14 ETAZ14 ETBE14 ETFZ14 ## 1 65.566193 463.00000 33.000000 376.00000 47 9 2 5 ## 2 17.644456 141.62963 9.835391 120.97531 22 1 3 1 ## 3 7551.682296 8962.84216 1059.728437 6681.86216 1316 7 60 131 ## 4 286.611037 1043.12909 66.326127 842.14083 141 14 7 19 ## 5 5.285714 71.34545 7.927273 57.47273 7 0 0 0 ## 6 491.138876 1614.00000 108.000000 1267.00000 203 21 18 21 ## ETGU14 ETGZ14 ETOQ14 ETTEF114 ETTEFP1014 ## 1 25 6 6 9 0 ## 2 14 4 3 2 0 ## 3 892 283 226 385 109 ## 4 85 19 16 27 5 ## 5 5 1 2 0 0 ## 6 114 28 29 38 15 tail(base) # 6 dernières lignes ## CODGEO LIBGEO REG DEP ## 36684 97419 Sainte-Rose 4 974 ## 36685 97420 Sainte-Suzanne 4 974 ## 36686 97421 Salazie 4 974 ## 36687 97422 Le Tampon 4 974 ## 36688 97423 Les Trois-Bassins 4 974 ## 36689 97424 Cilaos 4 974 ## ZAU ZE ## 36684 400 - Commune isol\\xe9e hors influence des p\\xf4les 0401 - L&#39;Est ## 36685 112 - Couronne d&#39;un grand p\\xf4le 0402 - Le Nord ## 36686 400 - Commune isol\\xe9e hors influence des p\\xf4les 0401 - L&#39;Est ## 36687 111 - Grand p\\xf4le (plus de 10 000 emplois) 0404 - Le Sud ## 36688 112 - Couronne d&#39;un grand p\\xf4le 0403 - L&#39;Ouest ## 36689 400 - Commune isol\\xe9e hors influence des p\\xf4les 0404 - Le Sud ## P14_POP P09_POP SUPERF NAIS0914 DECE0914 P14_MEN NAISD15 DECESD15 ## 36684 6722 6822 177.60 519 186 2322.000 94 43 ## 36685 22406 22437 57.84 1963 508 7686.912 358 100 ## 36686 7132 7406 103.82 661 235 2420.000 111 46 ## 36687 76796 72658 165.43 6663 2004 29662.460 1339 420 ## 36688 7198 7057 42.58 531 217 2484.887 104 54 ## 36689 5295 5989 84.40 430 186 2016.000 87 38 ## P14_LOG P14_RP P14_RSECOCC P14_LOGVAC P14_RP_PROP NBMENFISC13 PIMP13 ## 36684 2542.478 2322.000 28.58054 191.8979 1799.954 NA NA ## 36685 8328.616 7686.912 50.94097 590.7629 4450.648 NA NA ## 36686 2987.000 2420.000 174.00000 393.0000 1849.000 NA NA ## 36687 32710.091 29662.460 1004.31703 2043.3140 15372.921 NA NA ## 36688 2890.404 2484.887 67.58626 337.9313 1773.765 NA NA ## 36689 2732.690 2016.000 239.56501 477.1253 1522.480 NA NA ## MED13 TP6013 P14_EMPLT P14_EMPLT_SAL P09_EMPLT P14_POP1564 P14_CHOM1564 ## 36684 NA NA 1272.841 920.0617 1269.573 4306.217 1250.516 ## 36685 NA NA 4296.362 3618.1538 4185.015 14821.042 3712.486 ## 36686 NA NA 1519.306 1090.0856 1533.305 4650.000 1369.000 ## 36687 NA NA 16145.620 12486.5465 14807.249 50316.640 12783.137 ## 36688 NA NA 1273.858 994.3469 1202.079 4850.570 1360.617 ## 36689 NA NA 1194.383 993.1546 1314.121 3461.457 1122.361 ## P14_ACT1564 ETTOT14 ETAZ14 ETBE14 ETFZ14 ETGU14 ETGZ14 ETOQ14 ETTEF114 ## 36684 2850.155 414 125 44 31 159 59 55 82 ## 36685 10456.196 1323 136 139 190 694 249 164 267 ## 36686 3108.000 490 148 29 43 214 73 56 95 ## 36687 34446.789 5476 565 398 665 3025 999 823 1032 ## 36688 3524.287 456 42 39 61 223 76 91 59 ## 36689 2415.666 360 49 17 35 193 49 66 65 ## ETTEFP1014 ## 36684 8 ## 36685 66 ## 36686 11 ## 36687 204 ## 36688 20 ## 36689 26 class(base) # la classe de l&#39;objet (du point de vue langage orienté objet) ## [1] &quot;data.frame&quot; typeof(base) # le type d&#39;objet du point de vue &quot;interne&quot; à R ## [1] &quot;list&quot; 5.8 Exercice 2 : importer des données et premier coup d’oeil On peut importer n’importe quel format de données en R (Excel, SAT, Stata, SQL…). Beaucoup sont abordés lors du module 2 “Préparation des données”. Pour ce module, nous ne voyons que l’importation de fichier .CSV. Si vous avez une base de données en Excel ou LibreOffice Calc, sauvegardez l’onglet que vous souhaitez en faisant “enregistrer sous” \\(\\rightarrow\\) “délimité CSV.” Ici, nous travaillerons sur une base de données communales fournie par l’Insee, dite “comparateur de territoires.” Utiliser la fonction read.csv() pour importer ce fichier et stocker le dans un objet df. Veillez à ce que la région soit bien importée comme un facteur et non un entier Inspecter le dataframe avec les fonctions vues auparavant pour connaître le nombre de lignes, de colonnes, … 5.9 Catalogue d’attributs de la base CODGEO : [text] Code du département suivi du numéro de commune ou du numéro d’arrondissement municipal LIBGEO : [text] Libellé de la commune ou de l’arrondissement municipal pour Paris REG: [text] Région DEP : [text] Département ZAU : [text] Zonage en aire urbaine ZE : [text] Zone d’emploi P14_POP: [double] Population en 2014 P09_POP: [double] Population en 2009 SUPERF: [double] Superficie (en km2) NAIS0914: [double] Nombre de naissances entre le 01/01/2009 et le 01/01/2014 DECE0914: [double] Nombre de décès entre le 01/01/2009 et le 01/01/2014 P14_MEN: [double] Nombre de ménages en 2014 NAISD15: [double] Nombre de naissances domiciliées en 2015 DECESD15: [double] Nombre de décès domiciliés en 2015 P14_LOG: [double] Nombre de logements en 2014 P14_RP: [double] Nombre de résidences principales en 2014 P14_RSECOCC: [double] Nombre de résidences secondaires et logements occasionnels en 2014 P14_LOGVAC: [double] Nombre de logements vacants en 2014 P14_RP_PROP: [double] Nombre de résidences principales occupées par propriétaires en 2014 NBMENFISC13: [double] Nombre de ménages fiscaux en 2013 PIMP13: [text] Part des ménages fiscaux imposés en 2013 MED13: [double] Médiane du niveau de vie en 2013 TP6013: [text] Taux de pauvreté en 2013 P14_EMPLT: [double] Nombre d’emplois au lieu de travail en 2014 P14_EMPLT_SAL: [double] Nombre d’emplois salariés au lieu de travail en 2014 P09_EMPLT: [double] Nombre d’emplois au lieu de travail en 2009 P14_POP1564: [double] Nombre de personnes de 15 à 64 ans en 2014 P14_CHOM1564: [double] Nombre de chômeurs de 15 à 64 ans en 2014 P14_ACT1564: [double] Nombre de personnes actives de 15 à 64 ans en 2014 ETTOT14: [double] Total des établissements actifs au 31 décembre 2014 ETAZ14: [double] Etablissements actifs de l’agriculture, sylviculture et pêche au 31/12/2014 ETBE14: [double] Etablissements actifs de l’industrie au 31/12/2014 ETFZ14: [double] Etablissements actifs de la construction au 31/12/2014 ETGU14: [double] Etablissements actifs du commerce, transports et services divers au 31/12/2014 ETGZ14: [double] Etablissements actifs du commerce et réparation automobile au 31/12/2014 ETOQ14: [double] Etablissements actifs de l’administration publique, enseignement, santé et action sociale au 31/12/2014 ETTEF114: [double] Etablissements actifs de 1 à 9 salariés au 31 décembre 2014 ETTEFP1014: [double] Etablissements actifs de 10 salariés ou plus au 31 décembre 2014 "],["première-manipulation-des-données.html", "Chapitre 6 Première manipulation des données 6.1 Afficher les valeurs et manipuler les variables 6.2 Créer de nouvelles variables 6.3 Sélectionner des variables 6.4 Filtrer des observations 6.5 Les tests logiques dans R 6.6 Renommer des colonnes 6.7 Exercice 3 : créer, filtrer, sélectionner 6.8 Nom d’un pipe %&gt;% !", " Chapitre 6 Première manipulation des données library(&quot;dplyr&quot;) 6.1 Afficher les valeurs et manipuler les variables Pour afficher la table, plusieurs façons : “clic” dans l’environnement Rstudio, View(base), print(base), base. Pour accéder à une variable : fonction pull() Par exemple : str(pull(base, DEP)) ## chr [1:36689] &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; &quot;01&quot; ... 6.2 Créer de nouvelles variables La fonction mutate() permet de créer/modifier une variable (ou plusieurs). TableEnSortie &lt;- mutate(TableEnEntree, NouvelleVariable = DefinitionDeLaVariable) Par exemple : base &lt;- mutate(base, log_SUPERF = log(SUPERF)) Nb : mutate() permet également de modifier une variable. Dans ce cas la syntaxe est la même que ci-dessus, mais les noms d’entrée et de sortie sont les mêmes : base &lt;- mutate(base, log_SUPERF = 100 * log_SUPERF) \\(\\Rightarrow\\) La table base contient de nouvelles colonnes 6.3 Sélectionner des variables La fonction select() permet de sélectionner les variables voulues. sélection par liste blanche TableEnSortie &lt;- select(TableEnEntree, Variable1, Variable2, ..., VariableN) sélection par liste noire (supprimer) TableEnSortie &lt;- select(TableEnEntree, -Variable1, -Variable2, ..., -VariableN) Par exemple : base_select &lt;- select(base, CODGEO, LIBGEO, P14_POP) base_select &lt;- select(base, -CODGEO) 6.4 Filtrer des observations La fonction filter() permet de sélectionner les observations, selon une condition (ou plusieurs). TableEnSortie &lt;- filter(TableEnSortie, Condition1, ..., ConditionN) Par exemple : base_filter &lt;- filter(base, DEP == &quot;01&quot; &amp; P14_POP &gt; 10000) \\(\\Rightarrow\\) Attention à l’opérateur de comparaison : \" == \" et non pas “=” 6.5 Les tests logiques dans R Syntaxe Action == Test d’égalité != Différent de %in% c(...) Dans une liste de valeurs &gt;, &gt;= , &lt;, &lt;= Supérieur (ou inférieur) (ou égal) ! (x %in% c(...)) N’est pas dans une liste de valeurs TableEnSortie &lt;- filter(TableEnSortie, x==a &amp; y==b) # x vaut a **ET** y vaut b TableEnSortie &lt;- filter(TableEnSortie, x==a | y==b) # x vaut a **OU** y vaut b (barre verticale AltGR+6) 6.6 Renommer des colonnes La fonction rename() permet de renommer une variable (ou plusieurs). base &lt;- rename(base, nouveau_nom = ancien_nom) Exemple base_rename &lt;- rename(base, ZONE_EMPLOI = ZE) 6.7 Exercice 3 : créer, filtrer, sélectionner En utilisant la fonction mutate(), créer une nouvelle variable correspondant à la densité de population (rapport de la population à la superficie de la commune), ainsi que les taux de natalité et de mortalité (en pour mille de la population 2014) A l’aide de la fonction select(), créer une nouvelle table en ne conservant que le code commune, le type de commune (ZAU), la région, le département et les variables que vous venez de créer. Enfin, ne conserver les communes correspondant à votre département de naissance et stocker ce dataframe. Attention au type de la variable département ! Avec les opérateurs logiques, faire des essais pour sélectionner des échantillons différents (autres départements, densité, l’un et l’autre…). 6.8 Nom d’un pipe %&gt;% ! Pour enchaîner des opérations, on peut créer des variables successives : df &lt;- mutate(base, densite = P14_POP / SUPERF, tx_natal = 1000 * NAISD15 / P14_POP, tx_mort = DECESD15 / P14_POP) selection &lt;- select(df, CODGEO, ZAU, REG, DEP, densite, tx_natal) filtre_62 &lt;- filter(selection, DEP == &quot;62&quot;) Cela peut être relativement clair si on respecte de bonnes pratiques de nommage mais encombre inutilement l’environnement de travail. On peut emboîter les fonctions : selection_62 &lt;- filter(select(mutate(base, densite = P14_POP / SUPERF, tx_natal = 1000 * NAISD15 / P14_POP, tx_mort = DECESD15 / P14_POP), CODGEO, ZAU, REG, DEP, densite, tx_natal), DEP == &quot;62&quot;) Ce choix préserve l’environnement de travail mais la lecture est particulièrement confuse et le risque d’oubli de parenthèses important. Il y a enfin une solution du package magrittr faisant partie du tidyverse. On peut combiner les opérations en une seule ligne à l’aide de l’opérateur pipe %&gt;% : selection_62 &lt;- base %&gt;% mutate(densite = P14_POP / SUPERF, tx_natal = 1000 * NAISD15 / P14_POP, tx_mort = DECESD15 / P14_POP) %&gt;% select(CODGEO, ZAU, REG, DEP, densite, tx_natal) %&gt;% filter(DEP == &quot;62&quot;) Cette écriture permet d’enchaîner les opérations telles qu’on les décrirait à l’oral. L’objet auquel s’applique chaque nouvelle opération est le résultat de l’opération précédente. "],["premiers-traitements-statistiques.html", "Chapitre 7 Premiers traitements statistiques 7.1 Obtenir des informations 7.2 Calculer des statistiques spécifiques 7.3 Agréger des données 7.4 Tableau de contingence 7.5 Tableau de proportions 7.6 Exercice 4 : calcul de statistiques", " Chapitre 7 Premiers traitements statistiques 7.1 Obtenir des informations La fonction summary() peut s’appliquer à une table entière ou un vecteur. Appliquée sur un tableau, elle donne les statistiques principales sur chacune des variables, en s’adaptant au type de celles-ci (numerique ou texte). base_extrait &lt;- base %&gt;% select(1, 3, 5, 7:12) summary(base_extrait) ## CODGEO REG ZAU P14_POP ## Length:36689 Min. : 1.00 Length:36689 Min. : 0 ## Class :character 1st Qu.:28.00 Class :character 1st Qu.: 197 ## Mode :character Median :44.00 Mode :character Median : 444 ## Mean :52.05 Mean : 1838 ## 3rd Qu.:76.00 3rd Qu.: 1110 ## Max. :94.00 Max. :2220445 ## NA&#39;s :821 ## P09_POP SUPERF NAIS0914 DECE0914 ## Min. : 0 Min. : 0.04 Min. : 0.0 Min. : 0.00 ## 1st Qu.: 193 1st Qu.: 6.44 1st Qu.: 9.0 1st Qu.: 8.00 ## Median : 431 Median : 10.81 Median : 23.0 Median : 17.00 ## Mean : 1793 Mean : 17.64 Mean : 114.4 Mean : 77.35 ## 3rd Qu.: 1072 3rd Qu.: 18.58 3rd Qu.: 60.0 3rd Qu.: 43.00 ## Max. :2234105 Max. :18360.00 Max. :150843.0 Max. :69907.00 ## NA&#39;s :821 NA&#39;s :821 NA&#39;s :821 NA&#39;s :821 ## P14_MEN ## Min. : 0.0 ## 1st Qu.: 83.8 ## Median : 183.2 ## Mean : 802.0 ## 3rd Qu.: 454.9 ## Max. :1147990.9 ## NA&#39;s :821 Les variables quantitatives summary(pull(base_extrait, NAIS0914)) ## Min. 1st Qu. Median Mean 3rd Qu. Max. NA&#39;s ## 0.0 9.0 23.0 114.4 60.0 150843.0 821 Les variables qualitatives summary(pull(base_extrait, ZAU)) ## Length Class Mode ## 36689 character character 7.2 Calculer des statistiques spécifiques Les fonctions sum(), mean(), median(), min(), max(), var(), sd()… résument l’information pour en donner une statistique. La fonction quantile() renvoie les quartiles de la variables (ou bien tout autre découpage qu’on lui renseigne). sum(pull(base_extrait, P14_POP), na.rm = TRUE) ## [1] 65907160 mean(pull(base_extrait, P14_POP), na.rm = TRUE) ## [1] 1837.492 median(pull(base_extrait, P14_POP), na.rm = TRUE) ## [1] 444 quantile(pull(base_extrait, P14_POP), probs = c(0.25, 0.5, 0.75), na.rm = T) ## 25% 50% 75% ## 197 444 1110 Ces fonctions retournent une valeur, ou bien un ensemble de valeur (pour quantile()). Le résultat est donc un vecteur de un ou plusieurs nombres. 7.3 Agréger des données 7.3.1 Globalement La fonction summarise() permet d’aggréger des données, en appliquant une fonction sur les variables pour construire une statistique sur les observations de la table. C’est une fonction dite de “résumé.” summarise(TableEnEntree, NomVariableAgregee = Fonction(NomVariableEtude)) base_med &lt;- base_extrait %&gt;% summarise(population_med = median(P14_POP, na.rm = T)) La fonction summarise() retourne un data.frame. 7.3.2 Selon un facteur La fonction summarise() couplée à group_by() permet de calculer des statistiques pour chaque modalité d’une variable qualitative. Avec group_by(), on précise les variables qui formeront des groupes, sur lesquels on appliquera une fonction : TableauGroupes &lt;- group_by(TableEnEntree, Variable1, ..., VariableN) summarise(TableauGroupes, NomVariableAgregee = Fonction (NomVariableEtude)) Par exemple, si on veut avoir la médiane de la variable P14_POP, pour chaque ZAU et chaque région : base_reg_ann &lt;- base_extrait %&gt;% group_by(ZAU, REG) %&gt;% summarise(population_med = median (P14_POP, na.rm = TRUE)) 7.4 Tableau de contingence La fonction table() calcule les effectifs d’un tableau croisé : t &lt;- base_extrait %&gt;% select(ZAU, REG) %&gt;% table() print(t) ## REG ## ZAU 1 2 3 4 11 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 17 16 3 10 413 ## 112 - Couronne d&#39;un grand p\\xf4le 6 0 3 3 853 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 1 4 0 4 3 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 0 3 2 2 3 ## 212 - Couronne d&#39;un moyen p\\xf4le 0 0 0 0 2 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 3 2 1 0 0 ## 222 - Couronne d&#39;un petit p\\xf4le 0 0 0 0 0 ## 300 - Autre commune multipolaris\\xe9e 2 4 0 1 7 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 3 5 13 4 0 ## REG ## ZAU 24 27 28 32 44 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 103 140 216 481 322 ## 112 - Couronne d&#39;un grand p\\xf4le 734 1299 1126 1505 1721 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 188 336 488 729 822 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 30 31 34 33 54 ## 212 - Couronne d&#39;un moyen p\\xf4le 72 122 104 18 102 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 46 60 78 54 89 ## 222 - Couronne d&#39;un petit p\\xf4le 19 137 29 18 118 ## 300 - Autre commune multipolaris\\xe9e 375 737 762 711 1155 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 275 969 396 289 815 ## REG ## ZAU 52 53 75 76 84 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 108 89 333 258 548 ## 112 - Couronne d&#39;un grand p\\xf4le 535 415 1161 1124 1484 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 186 152 254 333 390 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 23 47 51 79 43 ## 212 - Couronne d&#39;un moyen p\\xf4le 44 18 81 155 84 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 69 42 163 123 113 ## 222 - Couronne d&#39;un petit p\\xf4le 8 1 81 89 47 ## 300 - Autre commune multipolaris\\xe9e 386 325 1002 877 517 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 143 181 1379 1527 963 ## REG ## ZAU 93 94 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 220 8 ## 112 - Couronne d&#39;un grand p\\xf4le 229 99 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 69 3 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 20 1 ## 212 - Couronne d&#39;un moyen p\\xf4le 11 2 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 32 13 ## 222 - Couronne d&#39;un petit p\\xf4le 6 29 ## 300 - Autre commune multipolaris\\xe9e 107 53 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 269 152 7.5 Tableau de proportions La fonction prop.table() prend en entrée un objet table (tableau de contingence avec les effectifs) et calcule les pourcentages (total, ligne, colonne) associés \\(\\rightarrow\\) ?prop.table # Calcule la fréquence en % (la somme de tous les pourcentages vaut 100) (prop.table(t) * 100) %&gt;% round(digits = 1) ## REG ## ZAU 1 2 3 4 11 24 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 0.0 0.0 0.0 0.0 1.1 0.3 ## 112 - Couronne d&#39;un grand p\\xf4le 0.0 0.0 0.0 0.0 2.3 2.0 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 0.0 0.0 0.0 0.0 0.0 0.5 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 0.0 0.0 0.0 0.0 0.0 0.1 ## 212 - Couronne d&#39;un moyen p\\xf4le 0.0 0.0 0.0 0.0 0.0 0.2 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 0.0 0.0 0.0 0.0 0.0 0.1 ## 222 - Couronne d&#39;un petit p\\xf4le 0.0 0.0 0.0 0.0 0.0 0.1 ## 300 - Autre commune multipolaris\\xe9e 0.0 0.0 0.0 0.0 0.0 1.0 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 0.0 0.0 0.0 0.0 0.0 0.7 ## REG ## ZAU 27 28 32 44 52 53 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 0.4 0.6 1.3 0.9 0.3 0.2 ## 112 - Couronne d&#39;un grand p\\xf4le 3.5 3.1 4.1 4.7 1.5 1.1 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 0.9 1.3 2.0 2.2 0.5 0.4 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 0.1 0.1 0.1 0.1 0.1 0.1 ## 212 - Couronne d&#39;un moyen p\\xf4le 0.3 0.3 0.0 0.3 0.1 0.0 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 0.2 0.2 0.1 0.2 0.2 0.1 ## 222 - Couronne d&#39;un petit p\\xf4le 0.4 0.1 0.0 0.3 0.0 0.0 ## 300 - Autre commune multipolaris\\xe9e 2.0 2.1 1.9 3.1 1.1 0.9 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 2.6 1.1 0.8 2.2 0.4 0.5 ## REG ## ZAU 75 76 84 93 94 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 0.9 0.7 1.5 0.6 0.0 ## 112 - Couronne d&#39;un grand p\\xf4le 3.2 3.1 4.0 0.6 0.3 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 0.7 0.9 1.1 0.2 0.0 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 0.1 0.2 0.1 0.1 0.0 ## 212 - Couronne d&#39;un moyen p\\xf4le 0.2 0.4 0.2 0.0 0.0 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 0.4 0.3 0.3 0.1 0.0 ## 222 - Couronne d&#39;un petit p\\xf4le 0.2 0.2 0.1 0.0 0.1 ## 300 - Autre commune multipolaris\\xe9e 2.7 2.4 1.4 0.3 0.1 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 3.8 4.2 2.6 0.7 0.4 # Calcule la fréquence en % par région (la somme de tous les pourcentages d&#39;une colonne vaut 100) (prop.table(t,&quot;REG&quot;) * 100) %&gt;% round(digits = 1) ## REG ## ZAU 1 2 3 4 11 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 53.1 47.1 13.6 41.7 32.2 ## 112 - Couronne d&#39;un grand p\\xf4le 18.8 0.0 13.6 12.5 66.6 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 3.1 11.8 0.0 16.7 0.2 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 0.0 8.8 9.1 8.3 0.2 ## 212 - Couronne d&#39;un moyen p\\xf4le 0.0 0.0 0.0 0.0 0.2 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 9.4 5.9 4.5 0.0 0.0 ## 222 - Couronne d&#39;un petit p\\xf4le 0.0 0.0 0.0 0.0 0.0 ## 300 - Autre commune multipolaris\\xe9e 6.2 11.8 0.0 4.2 0.5 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 9.4 14.7 59.1 16.7 0.0 ## REG ## ZAU 24 27 28 32 44 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 5.6 3.7 6.7 12.5 6.2 ## 112 - Couronne d&#39;un grand p\\xf4le 39.8 33.9 34.8 39.2 33.1 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 10.2 8.8 15.1 19.0 15.8 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 1.6 0.8 1.1 0.9 1.0 ## 212 - Couronne d&#39;un moyen p\\xf4le 3.9 3.2 3.2 0.5 2.0 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 2.5 1.6 2.4 1.4 1.7 ## 222 - Couronne d&#39;un petit p\\xf4le 1.0 3.6 0.9 0.5 2.3 ## 300 - Autre commune multipolaris\\xe9e 20.4 19.2 23.6 18.5 22.2 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 14.9 25.3 12.2 7.5 15.7 ## REG ## ZAU 52 53 75 76 84 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 7.2 7.0 7.4 5.7 13.1 ## 112 - Couronne d&#39;un grand p\\xf4le 35.6 32.7 25.8 24.6 35.4 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 12.4 12.0 5.6 7.3 9.3 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 1.5 3.7 1.1 1.7 1.0 ## 212 - Couronne d&#39;un moyen p\\xf4le 2.9 1.4 1.8 3.4 2.0 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 4.6 3.3 3.6 2.7 2.7 ## 222 - Couronne d&#39;un petit p\\xf4le 0.5 0.1 1.8 1.9 1.1 ## 300 - Autre commune multipolaris\\xe9e 25.7 25.6 22.2 19.2 12.3 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 9.5 14.3 30.6 33.5 23.0 ## REG ## ZAU 93 94 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) 22.8 2.2 ## 112 - Couronne d&#39;un grand p\\xf4le 23.8 27.5 ## 120 - Multipolaris\\xe9e des grandes aires urbaines 7.2 0.8 ## 211 - Moyen p\\xf4le (5 000 \\xe0 10 000 emplois) 2.1 0.3 ## 212 - Couronne d&#39;un moyen p\\xf4le 1.1 0.6 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) 3.3 3.6 ## 222 - Couronne d&#39;un petit p\\xf4le 0.6 8.1 ## 300 - Autre commune multipolaris\\xe9e 11.1 14.7 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les 27.9 42.2 Attention: la fonction prop.table() a été améliorée avec le changement de version de R base. La version &lt;3.6.2 ne permettait pas d’utiliser le nom de la variable (ici “REG”) pour spécifier le mode de calcul des fréquences, l’option était alors margin= (1: en ligne, 2: en colonne) 7.6 Exercice 4 : calcul de statistiques Utilisez la fonction summary() pour obtenir un résumé de l’ensemble des variables de la table df Calculez maintenant les moyenne, médiane, écart-type et variance de la variable de densité de population. Que constatez-vous ? Utilisez le paramètre na.rm = TRUE pour gérer les valeurs manquantes Calculez à présent les quartiles puis déciles de cette variables Calculez la version centrée réduite de la variable de densité. Rappel : on calcule la version centrée réduite d’une variable X en lui appliquant la transformation suivante : \\[ STD_X =\\dfrac{X-\\bar{X}}{\\sigma_X}\\] où \\(\\bar{X}\\) est la moyenne empirique de X et \\(\\sigma_X\\) son écart-type Tableaux croisés : Calculer le nombre de communes par type d’espace à l’aide de la fonction table, et le pourcentage associé Calculer le nombre de communes par région et type d’espace, et les pourcentages associés Pour aller plus loin et ajouter des variables de pondération, calculer les profils-ligne ou profils-colonne, rendez-vous au module 3 “Statistiques descriptives” ou demander à un GF (Gentil Formateur). "],["premiers-graphiques.html", "Chapitre 8 Premiers graphiques 8.1 Package ggplot2 8.2 Histogramme 8.3 Nuages de points 8.4 Matrice de nuages 8.5 Bonus : faire un graphique “dynamique” 8.6 Exercice : créer des graphiques", " Chapitre 8 Premiers graphiques 8.1 Package ggplot2 Pour réaliser des graphiques, nous choisissons de nous servir du package ggplot2, qui permet de faire de meilleures réalisations que les fonctions basiques. Il est intégré dans le méta-package tidyverse donc il n’est pas utile de le re-charger dans notre session. Mais si vous devez le faire, le code est le suivant : install.packages(&quot;ggplot2&quot;) library(&quot;ggplot2&quot;) library(dplyr) La fonction ggplot() fonctionne d’une manière particulière. La structure ressemble à ceci : ggplot(TableEnEntree, aes(VariablesATracer)) + geom_FonctionAChoisir() Pour découvrir les nombreuses possibilités de ggplot2, vous pouvez vous référer au Module 5 : « Valoriser ses données avec R » ou consulter les sites suivants : Version anglaise Version française La fonction aes() (pour “aesthetics”), utilisée dans l’instruction ggplot() permet de définir les données à tracer. On y indique les dimensions que l’on veut représenter sur le graphique. On peut représenter jusqu’à 5 dimensions sur un même graphique, mais attention à la lisibilité ! 2 variables quanti : x en fonction de y \\(\\rightarrow\\) 2 dimensions (nuage de points) taille du point \\(\\rightarrow\\) 3e dimension (quanti) couleur des points \\(\\rightarrow\\) 4e dimension (quali) juxtaposer des graphiques en fonction d’une variable quali \\(\\rightarrow\\) 5e dimension ! 8.2 Histogramme Si on désire un histogramme de log_SUPERF, on fera appel à la fonction geom_histogram(). Ce graphique ne présente qu’une seule dimension (la variable quanti dont on veut visualiser la distribution) rm(list = ls()) base &lt;- read.csv(file = &quot;extdata/Base_synth_territoires.csv&quot;, header = T, sep=&quot;;&quot;, dec=&quot;,&quot;) %&gt;% select(1:24) %&gt;% mutate(log_SUPERF = log(SUPERF), REG = as.factor(REG), densite = P14_POP / SUPERF, tx_natal = 1000 * NAISD15 / P14_POP, tx_mort = DECESD15 / P14_POP) ggplot(data = base, mapping = aes(x = log_SUPERF)) + geom_histogram() 8.3 Nuages de points Selon les graphiques que l’on veut tracer, on peut renseigner plusieurs variables. Dans le cas d’un nuage de points, par exemple, on croise 2 variables quantitatives : ggplot(base, aes(x = P14_EMPLT, y = MED13)) + geom_point(colour = &quot;blue&quot;) ggplot(base, aes(x = log(P14_EMPLT), y = log(MED13))) + geom_point(colour = &quot;blue&quot;) 8.4 Matrice de nuages Pour explorer son jeu de données, on peut réaliser un nuage de points pour plusieurs croisements de variables possibles. Ici, en conservant quelques variables quantitatives, on peut réaliser un ensemble de graphiques. Cette “matrice” de nuages fonctionne avec le package GGally. # install.packages(&quot;GGally&quot;) library(&quot;GGally&quot;) num &lt;- select(base, P14_LOGVAC:PIMP13) %&gt;% sample_n(10000) %&gt;% log() ggpairs(num) ## fonction ggpairs() de GGally 8.5 Bonus : faire un graphique “dynamique” Une fois qu’on a généré un graphique avec ggplot, on peut le passer dans la fonction ggplotly() (package plotly) qui permet de le rendre dynamique. library(plotly) g &lt;- ggplot(data = base, aes(x = REG, fill = REG)) + geom_bar() ggplotly(g) 8.6 Exercice : créer des graphiques À l’aide de l’aide mémoire ggplot2 : Réaliser un histogramme de la population communale Transformer les données avec la fonction log pour y voir plus clair Faire un barplot du nombre de communes par REG Utiliser le paramètre fill de la fonction aes() pour améliorer le graphique Réaliser un graphique (nuage de points) croisant la densité de population et le taux de mortalité Ajouter une dimension supplémentaire avec la couleur des points (paramètre color de aes()) Note : avec les fonctions de base, on peut obtenir de nombreux graphiques avec très peu de code, mais moins jolis : plot(iris) Des possibilités infinies à approfondir dans les modules 3 et 5 !! "],["sauvegarder-son-travail.html", "Chapitre 9 Sauvegarder son travail 9.1 Exportation des résultats 9.2 Environnement et .RData", " Chapitre 9 Sauvegarder son travail Après avoir réalisé ces traitements, on peut exporter son travail afin de le finaliser dans un tableur ou un traitement de texte en vue d’une publication ou autre. On peut donc avoir à exporter soit des tableaux qu’on retouchera par la suite, soit des images de ses graphiques qu’on intégrera dans un document. Une dernière possibilité consiste à sauvegarder un ensemble d’objets R dans un seul fichier (RData) afin de retrouver son environnement de travail facilement en rouvrant une session de R. 9.1 Exportation des résultats Exporter une table en csv res &lt;- summary(base) write.table(x = res, file = &#39;outputs/resultat_R.csv&#39;, sep = &#39;;&#39;, row.names = FALSE) # row.names=F pour éviter un décalage entre première ligne et les suivantes write.table(x = base, file = &#39;outputs/base_R.csv&#39;, sep = &#39;;&#39;, row.names = FALSE) Exporter un graphique pour l’intégrer à un document png(&#39;outputs/mongraphe.png&#39;) # Alloue et ouvre le fichier où inscrire le graphe ggplot(base, aes(x = P14_EMPLT, y = MED13)) + geom_point(colour = &quot;blue&quot;) dev.off() # Ferme le fichier \\(\\rightarrow\\) Beaucoup d’autres fonctions : jpeg, pdf, postscript, svg… 9.2 Environnement et .RData Il est possible de sauvegarder des objets R (dataframe, vecteur, etc…) directement sur son ordinateur. Une liste d’objets R est enregistrée sous le format .RData. save(list = ls(), file = &quot;outputs/env_entier.RData&quot;) # sauvegarde de tout l&#39;environnement sur le répertoire choisi rm(list = ls()) # suppression de notre environnement dans R load(&quot;outputs/env_entier.RData&quot;) # chargement de l&#39;environnement stocké sur l&#39;ordinateur save(base, res, file = &quot;outputs/petit_env.RData&quot;) # sauvegarde des éléments base et V1 rm(list = ls()) # suppression de notre environnement load(&quot;outputs/petit_env.RData&quot;) Avantages - Un seul fichier peut contenir des dataframes, des graphiques, des fonctions, etc. - La lecture est très rapide \\(\\Rightarrow\\) utile pour les gros volumes de données "],["aller-plus-loin-avec-les-objets-et-la-programmation-fonctionnelle.html", "Chapitre 10 Aller plus loin avec les objets et la programmation fonctionnelle 10.1 Les objets dans R, plus de détails 10.2 Créer une nouvelle fonction en R 10.3 Les boucles conditionnelles 10.4 Les boucles 10.5 Pour aller plus loin", " Chapitre 10 Aller plus loin avec les objets et la programmation fonctionnelle Ce qui a été présenté dans ce module repose sur les fonctions du package tidyverse. Cette approche tend à se généraliser depuis quelques années, mais quand on cherche la réponse à un problème sur Internet, on trouve d’autres façons de programmer en R, qui font appel aux fonctions du package base et non du tidyverse \\(\\Rightarrow\\) Cette partie donne quelques clés de compréhension. 10.1 Les objets dans R, plus de détails Rappel : en informatique, un objet est défini par : ses attributs et ses méthodes (fonctions). Dans l’exemple du jeu d’échec, chaque pièce peut être vue comme un objet : sa position sur le plateau constitue ses attributs sa façon de se déplacer peut être vue comme une fonction qui ne s’applique qu’à ce type de pièce, donc une méthode R est un langage orienté objet ; ces objets permettent de structurer les données selon leurs caractéristiques \\(\\Rightarrow\\) on retrouve les données dans les attributs. Les méthodes sont en général transparentes pour l’utilisateur (cf. utilisation des fonctions summary, plot…). Les objets les plus courants sont les suivants : Vecteurs : suite unidimensionnelle de valeurs ayant le même type. Facteurs : vecteur qui prend un nombre limité de modalités (exemple : sexe). Il est défini par les niveaux (levels) et les libellés associés (labels). Matrice et arrays : suites multidimensionnelles de valeurs (matrices=dimension 2 ; array=dimension n). A la différence d’une dataframe, les valeurs d’une matrice sont toutes du même type. Les arrays peuvent être très puissants pour gérer des millésimes. Liste : ensemble d’objets différents. On peut stocker un vecteur alphanumérique + une matrice numérique dans une liste. Tableaux (data.frame) : Objet qui ressemble le plus aux tables Excel, SAS ou SPSS… : description d’individus statistiques (observations, en ligne) par des caractéristiques (variables, en colonnes). Fonctions : Objets particuliers qui donnent un résultat à partir de paramètres en entrée. Autres objets : Il existe un très grand nombre d’objets ad hoc dans R. Par exemple ts (time serie) pour les séries temporelles, lm (linear model) qui contient tous les résultats d’une régression linéraire… des graphiques On peut même en définir de nouveaux soi-même ! 10.2 Créer une nouvelle fonction en R La fonction est un objet comme les autres, qu’on crée avec l’opérateur d’affectation. Elle est définie par des paramètres et elle se termine par la fonction return(). On reprend l’exemple du calcul de l’IMC calcul_IMC &lt;- function (poids, taille) { ## La taille est exprimée en mètres imc &lt;- poids / taille ^ 2 return (imc) } calcul_IMC (poids = 80, taille = 1.89) ## [1] 22.39579 calcul_IMC (poids = 60, taille = 1.55) ## [1] 24.97399 10.3 Les boucles conditionnelles Les commandes if et else sont bien entendues utilisables. Le “then” n’existe pas : il est implicite après les accolades. diag_IMC &lt;- function(poids,taille) { imc &lt;- poids / taille ^ 2 if (imc &lt; 18.5) {diag &lt;- &quot;maigre&quot;} else if (imc &lt; 25) {diag &lt;- &quot;normal&quot;} else {diag &lt;- &quot;surpoids&quot;} return (diag) } diag_IMC (poids=60,taille=1.89) ## [1] &quot;maigre&quot; diag_IMC (poids=80,taille=1.89) ## [1] &quot;normal&quot; diag_IMC (poids=80,taille=1.55) ## [1] &quot;surpoids&quot; 10.4 Les boucles On peut utiliser les boucles classiques : repeat, while, for : for (pp in seq(from = 50, to = 100, by = 5)) { print(paste (&quot;Taille = 1,70m, poids =&quot;, pp, &quot;Diagnotic :&quot;, diag_IMC (poids = pp, taille = 1.70))) } ## [1] &quot;Taille = 1,70m, poids = 50 Diagnotic : maigre&quot; ## [1] &quot;Taille = 1,70m, poids = 55 Diagnotic : normal&quot; ## [1] &quot;Taille = 1,70m, poids = 60 Diagnotic : normal&quot; ## [1] &quot;Taille = 1,70m, poids = 65 Diagnotic : normal&quot; ## [1] &quot;Taille = 1,70m, poids = 70 Diagnotic : normal&quot; ## [1] &quot;Taille = 1,70m, poids = 75 Diagnotic : surpoids&quot; ## [1] &quot;Taille = 1,70m, poids = 80 Diagnotic : surpoids&quot; ## [1] &quot;Taille = 1,70m, poids = 85 Diagnotic : surpoids&quot; ## [1] &quot;Taille = 1,70m, poids = 90 Diagnotic : surpoids&quot; ## [1] &quot;Taille = 1,70m, poids = 95 Diagnotic : surpoids&quot; ## [1] &quot;Taille = 1,70m, poids = 100 Diagnotic : surpoids&quot; 10.5 Pour aller plus loin 10.5.1 matrices et arrays Les matrices et les arrays permettent des calculs rapides et efficaces, et peuvent être très pratiques et optimisent le stockage des données. Ils demandent cependant plus de réflexion en amont quant à leur utilisation. On accède aux éléments avec les []. Un hypercube de trois dimensions peut être représenté comme suit : On peut par exemple créer une matrice à 10 lignes et 10 colonnes remplie avec un tirage aléatoire selon une loi normale centrée réduit. De la même façon on peut créer un hypercube avec la fonction avec 10 lignes, 5 colonnes et de profondeur 3, toujours avec un tirage aléatoire selon une loi normale mat &lt;- matrix(rnorm(50), ncol = 5, nrow = 10) arr &lt;- array(rnorm(150),dim = c(10,5,3)) mat ## [,1] [,2] [,3] [,4] [,5] ## [1,] -1.3190176 -0.3163225 -0.77604170 -0.22877963 0.04005827 ## [2,] -0.5762322 -0.9764535 0.99019701 0.05803465 1.06970575 ## [3,] -0.2890928 1.3622446 1.01104991 1.64477794 0.44392480 ## [4,] 0.9997040 -1.3599687 0.71328682 -1.42262655 -0.32494689 ## [5,] 2.8586207 0.3915147 -1.85301084 0.62765841 -2.44292187 ## [6,] 0.3893275 0.3478697 0.16570716 0.38140550 -0.63802834 ## [7,] -0.4708339 -1.0365684 -0.89968500 0.22750704 -0.33523359 ## [8,] 0.1774111 0.8339318 1.17253349 0.06924686 -0.06421467 ## [9,] 0.1543487 -1.2053547 0.02192704 -1.30593165 0.03426112 ## [10,] -0.4430990 0.7072403 0.42935562 -0.74402524 -1.09062996 arr ## , , 1 ## ## [,1] [,2] [,3] [,4] [,5] ## [1,] -0.4139993 1.2672625 -1.3991578 -2.0292404 -0.6953585 ## [2,] 1.0459114 -0.3179671 0.7680827 -0.9715310 -1.6393704 ## [3,] -0.1002643 0.5238484 -1.4629527 0.2559039 0.2414234 ## [4,] 0.1230348 0.4472900 0.9818828 -1.1747627 0.1193732 ## [5,] -0.4920905 -1.8005799 2.3001735 -2.7633527 0.2880128 ## [6,] 0.4329441 0.7485118 0.2155381 0.8020519 1.0422472 ## [7,] 1.2792661 1.0590098 -0.6372302 0.7121650 -0.6063093 ## [8,] 0.7477789 -1.4687705 -0.6779730 0.1080413 1.6030802 ## [9,] 0.7984556 1.6346540 -0.7552703 -0.9335830 0.3102962 ## [10,] -0.4894856 0.8819728 -0.5878578 -0.5863894 -0.2100085 ## ## , , 2 ## ## [,1] [,2] [,3] [,4] [,5] ## [1,] -0.00633697 -1.25307512 1.0026805 0.246330034 -1.28256371 ## [2,] -0.36299096 -0.58613238 -1.5881792 -0.717875540 -0.82182952 ## [3,] 0.60576784 0.49271570 -1.5331985 -0.368387775 0.93812810 ## [4,] -1.52176007 -0.49736889 -1.1236739 -0.004873981 0.52273229 ## [5,] 1.64515516 0.90618951 0.4776677 -1.488328550 0.92062484 ## [6,] -3.07939889 -0.32299812 0.4765603 -0.067212223 -1.38948777 ## [7,] -0.90347301 0.42294401 0.9569782 0.426652557 0.64174867 ## [8,] 0.25955643 0.41848026 0.3636171 -1.050857519 -0.42146557 ## [9,] -0.53069193 -0.36327699 0.0509995 0.275081097 0.08306832 ## [10,] -1.37145398 -0.04421105 -1.4096213 -0.064154132 -0.14737998 ## ## , , 3 ## ## [,1] [,2] [,3] [,4] [,5] ## [1,] -0.4728864 0.7457257 0.1474167 0.65275100 0.3877883 ## [2,] -2.1878319 0.2029380 0.2748163 -1.59495660 -0.6982329 ## [3,] 1.9965844 0.7690569 -3.0161655 -0.83267228 -0.5527749 ## [4,] -0.1981519 -2.1869778 -0.1512135 2.03163764 0.4813117 ## [5,] -0.4662294 -0.4580200 -1.8886384 0.25013185 -0.2249752 ## [6,] 0.6732329 1.0075149 -0.7208851 -0.05117024 0.8353079 ## [7,] -0.7815695 0.2090113 0.2239345 -0.31927464 0.4059447 ## [8,] -1.5001909 0.3586872 -0.4185586 -1.09933089 0.6811995 ## [9,] -1.7339855 0.4379130 0.1332396 0.97264979 0.3049285 ## [10,] 0.7246959 0.8239749 -0.9588972 -0.03079220 0.8206175 Pourquoi s’embêter avec ça ? Parce qu’on peut appliquer des fonctions facilement sur les lignes, colonnes et autres dimensions grâce à la fonction apply(). Exemple : résultats de validations croisées par bloc, simulations de loi selon différents paramètres. Et on calcule facilement des statistiques “marginales.” Par, exemple, sur une matrice, on peut calculer des statistiques par lignes : apply(mat, MARGIN = 1, FUN=mean) ## [1] -0.52002063 0.11305034 0.83458089 -0.27891026 -0.08362778 0.12925631 ## [7] -0.50296277 0.43778171 -0.46014991 -0.22823165 Ou par colonnes : apply(mat, MARGIN = 2, FUN=mean) ## [1] 0.14811365 -0.12518667 0.09753195 -0.06927327 -0.33080254 Sur notre hypercube de type array, on peut aussi calculer des stats sur ses différentes dimensions : apply (arr, MARGIN = 3, FUN=mean) ## [1] -0.02950584 -0.24377159 -0.11982742 apply (arr, MARGIN = c(2,3), FUN = mean) ## [,1] [,2] [,3] ## [1,] 0.29315512 -0.52656264 -0.394633232 ## [2,] 0.29752318 -0.08267331 0.190982420 ## [3,] -0.12547647 -0.23261697 -0.637495133 ## [4,] -0.65806968 -0.28136260 -0.002102656 ## [5,] 0.04533863 -0.09564243 0.244111523 10.5.2 Inspection d’un objet : la régression La régression linéaire consiste à exprimer une variable Y en fonction d’une variable X dans une fonction linéaire. C’est à dire qu’on cherche a et b tels que : \\[ Y = a \\cdot X + b + \\epsilon\\] où \\(\\epsilon\\) est le résidu de la régression. On utilise dans cet exemple la table des iris de Fisher, existant dans R base qu’il suffit d’appeler avec data(iris) (il existe d’autres dataframe inclus dans les packages et qui sont utilisés en exemple dans l’aide). data (&quot;iris&quot;) str (iris) ## &#39;data.frame&#39;: 150 obs. of 5 variables: ## $ Sepal.Length: num 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ... ## $ Sepal.Width : num 3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ... ## $ Petal.Length: num 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ... ## $ Petal.Width : num 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ... ## $ Species : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ... Faire la régression de la Sepal.Length sur Petal.length à l’aide de la fonction lm() lm (data = iris, formula = Sepal.Length ~ Petal.Length) ## ## Call: ## lm(formula = Sepal.Length ~ Petal.Length, data = iris) ## ## Coefficients: ## (Intercept) Petal.Length ## 4.3066 0.4089 On a les paramètres a et b mais on aimerait en savoir plus… Au moins la qualité d’ajustement (le \\(R^2\\) par exemple), et un graphique des résidus pour détecter une éventuelle structure. Pour cela, stocker le résultat dans un nouvel objet, et explorez-le avec les fonctions str(), summary() et plot() reg &lt;- lm(data = iris, formula = Sepal.Length ~ Petal.Length) str (reg) ## List of 12 ## $ coefficients : Named num [1:2] 4.307 0.409 ## ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot; ## $ residuals : Named num [1:150] 0.2209 0.0209 -0.1382 -0.32 0.1209 ... ## ..- attr(*, &quot;names&quot;)= chr [1:150] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ... ## $ effects : Named num [1:150] -71.566 8.812 -0.155 -0.337 0.104 ... ## ..- attr(*, &quot;names&quot;)= chr [1:150] &quot;(Intercept)&quot; &quot;Petal.Length&quot; &quot;&quot; &quot;&quot; ... ## $ rank : int 2 ## $ fitted.values: Named num [1:150] 4.88 4.88 4.84 4.92 4.88 ... ## ..- attr(*, &quot;names&quot;)= chr [1:150] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ... ## $ assign : int [1:2] 0 1 ## $ qr :List of 5 ## ..$ qr : num [1:150, 1:2] -12.2474 0.0816 0.0816 0.0816 0.0816 ... ## .. ..- attr(*, &quot;dimnames&quot;)=List of 2 ## .. .. ..$ : chr [1:150] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ... ## .. .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot; ## .. ..- attr(*, &quot;assign&quot;)= int [1:2] 0 1 ## ..$ qraux: num [1:2] 1.08 1.1 ## ..$ pivot: int [1:2] 1 2 ## ..$ tol : num 1e-07 ## ..$ rank : int 2 ## ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot; ## $ df.residual : int 148 ## $ xlevels : Named list() ## $ call : language lm(formula = Sepal.Length ~ Petal.Length, data = iris) ## $ terms :Classes &#39;terms&#39;, &#39;formula&#39; language Sepal.Length ~ Petal.Length ## .. ..- attr(*, &quot;variables&quot;)= language list(Sepal.Length, Petal.Length) ## .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1 ## .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2 ## .. .. .. ..$ : chr [1:2] &quot;Sepal.Length&quot; &quot;Petal.Length&quot; ## .. .. .. ..$ : chr &quot;Petal.Length&quot; ## .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;Petal.Length&quot; ## .. ..- attr(*, &quot;order&quot;)= int 1 ## .. ..- attr(*, &quot;intercept&quot;)= int 1 ## .. ..- attr(*, &quot;response&quot;)= int 1 ## .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; ## .. ..- attr(*, &quot;predvars&quot;)= language list(Sepal.Length, Petal.Length) ## .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot; ## .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Sepal.Length&quot; &quot;Petal.Length&quot; ## $ model :&#39;data.frame&#39;: 150 obs. of 2 variables: ## ..$ Sepal.Length: num [1:150] 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ... ## ..$ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ... ## ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39; language Sepal.Length ~ Petal.Length ## .. .. ..- attr(*, &quot;variables&quot;)= language list(Sepal.Length, Petal.Length) ## .. .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1 ## .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2 ## .. .. .. .. ..$ : chr [1:2] &quot;Sepal.Length&quot; &quot;Petal.Length&quot; ## .. .. .. .. ..$ : chr &quot;Petal.Length&quot; ## .. .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;Petal.Length&quot; ## .. .. ..- attr(*, &quot;order&quot;)= int 1 ## .. .. ..- attr(*, &quot;intercept&quot;)= int 1 ## .. .. ..- attr(*, &quot;response&quot;)= int 1 ## .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; ## .. .. ..- attr(*, &quot;predvars&quot;)= language list(Sepal.Length, Petal.Length) ## .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot; ## .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Sepal.Length&quot; &quot;Petal.Length&quot; ## - attr(*, &quot;class&quot;)= chr &quot;lm&quot; summary (reg) ## ## Call: ## lm(formula = Sepal.Length ~ Petal.Length, data = iris) ## ## Residuals: ## Min 1Q Median 3Q Max ## -1.24675 -0.29657 -0.01515 0.27676 1.00269 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 4.30660 0.07839 54.94 &lt;2e-16 *** ## Petal.Length 0.40892 0.01889 21.65 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 0.4071 on 148 degrees of freedom ## Multiple R-squared: 0.76, Adjusted R-squared: 0.7583 ## F-statistic: 468.6 on 1 and 148 DF, p-value: &lt; 2.2e-16 plot (reg) Les méthodes summary, print et plot sont implémentées pour tous les objets en R, et on peut les utiliser pour avoir un premier aperçu de ce que l’on obtient avec la fonction. "],["exercices-corrigés.html", "Chapitre 11 Exercices corrigés 11.1 04 - importer des données et premier coup d’oeil 11.2 06 - créer, filtrer, sélectionner 11.3 07 - calcul de statistiques 11.4 08 - créer des graphiques", " Chapitre 11 Exercices corrigés 11.1 04 - importer des données et premier coup d’oeil df &lt;- read.csv(file = &quot;extdata/Base_synth_territoires.csv&quot;, header = TRUE, sep = &quot;;&quot;, dec = &quot;,&quot;, colClasses = c(rep(&quot;character&quot;, 2), rep(&quot;factor&quot;, 4) , rep(NA, 32))) str(df) ## &#39;data.frame&#39;: 36689 obs. of 38 variables: ## $ CODGEO : chr &quot;01001&quot; &quot;01002&quot; &quot;01004&quot; &quot;01005&quot; ... ## $ LIBGEO : chr &quot;L&#39;Abergement-Cl\\xe9menciat&quot; &quot;L&#39;Abergement-de-Varey&quot; &quot;Amb\\xe9rieu-en-Bugey&quot; &quot;Amb\\xe9rieux-en-Dombes&quot; ... ## $ REG : Factor w/ 17 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 15 15 15 15 15 15 15 15 15 15 ... ## $ DEP : Factor w/ 100 levels &quot;01&quot;,&quot;02&quot;,&quot;03&quot;,..: 1 1 1 1 1 1 1 1 1 1 ... ## $ ZAU : Factor w/ 9 levels &quot;111 - Grand p\\xf4le (plus de 10 000 emplois)&quot;,..: 3 2 2 2 8 2 2 5 8 2 ... ## $ ZE : Factor w/ 321 levels &quot;0050 - Mont-de-Marsan&quot;,..: 260 248 248 260 263 248 248 263 266 250 ... ## $ P14_POP : int 767 239 14022 1627 109 2570 743 338 1142 397 ... ## $ P09_POP : int 787 207 13350 1592 120 2328 660 336 960 352 ... ## $ SUPERF : num 15.95 9.15 24.6 15.92 5.88 ... ## $ NAIS0914 : int 40 16 1051 117 8 175 59 12 56 25 ... ## $ DECE0914 : int 25 7 551 41 3 78 20 11 32 10 ... ## $ P14_MEN : num 306 99.3 6161.1 621.1 52.5 ... ## $ NAISD15 : int 13 5 222 15 2 21 11 2 18 4 ... ## $ DECESD15 : int 5 1 121 7 2 9 3 3 5 0 ... ## $ P14_LOG : num 342.7 161.2 6838.4 661.8 71.5 ... ## $ P14_RP : num 306 99.3 6161.1 621.1 52.5 ... ## $ P14_RSECOCC : num 14 47.3 121.6 10.9 10.9 ... ## $ P14_LOGVAC : num 22.74 14.55 555.64 29.85 8.14 ... ## $ P14_RP_PROP : num 260 84.6 2769 473.3 37.7 ... ## $ NBMENFISC13 : int 297 99 6034 617 47 1014 299 140 431 137 ... ## $ PIMP13 : num NA NA 57.4 NA NA ... ## $ MED13 : num 22130 23213 19554 22388 21872 ... ## $ TP6013 : num NA NA 15.1 NA NA ... ## $ P14_EMPLT : num 85.16 12.81 7452.93 280.57 5.95 ... ## $ P14_EMPLT_SAL: num 52.19 4.95 6743.37 206.38 3.96 ... ## $ P09_EMPLT : num 65.57 17.64 7551.68 286.61 5.29 ... ## $ P14_POP1564 : num 463 141.6 8962.8 1043.1 71.3 ... ## $ P14_CHOM1564 : num 33 9.84 1059.73 66.33 7.93 ... ## $ P14_ACT1564 : num 376 121 6681.9 842.1 57.5 ... ## $ ETTOT14 : int 47 22 1316 141 7 203 66 39 54 36 ... ## $ ETAZ14 : int 9 1 7 14 0 21 2 5 5 6 ... ## $ ETBE14 : int 2 3 60 7 0 18 0 2 6 4 ... ## $ ETFZ14 : int 5 1 131 19 0 21 9 1 13 3 ... ## $ ETGU14 : int 25 14 892 85 5 114 45 27 24 18 ... ## $ ETGZ14 : int 6 4 283 19 1 28 16 6 9 7 ... ## $ ETOQ14 : int 6 3 226 16 2 29 10 4 6 5 ... ## $ ETTEF114 : int 9 2 385 27 0 38 17 6 9 7 ... ## $ ETTEFP1014 : int 0 0 109 5 0 15 2 0 3 0 ... head(df) ## CODGEO LIBGEO REG DEP ## 1 01001 L&#39;Abergement-Cl\\xe9menciat 84 01 ## 2 01002 L&#39;Abergement-de-Varey 84 01 ## 3 01004 Amb\\xe9rieu-en-Bugey 84 01 ## 4 01005 Amb\\xe9rieux-en-Dombes 84 01 ## 5 01006 Ambl\\xe9on 84 01 ## 6 01007 Ambronay 84 01 ## ZAU ## 1 120 - Multipolaris\\xe9e des grandes aires urbaines ## 2 112 - Couronne d&#39;un grand p\\xf4le ## 3 112 - Couronne d&#39;un grand p\\xf4le ## 4 112 - Couronne d&#39;un grand p\\xf4le ## 5 300 - Autre commune multipolaris\\xe9e ## 6 112 - Couronne d&#39;un grand p\\xf4le ## ZE P14_POP P09_POP SUPERF NAIS0914 DECE0914 ## 1 8213 - Villefranche-sur-Sa\\xf4ne 767 787 15.95 40 25 ## 2 8201 - Amb\\xe9rieu-en-Bugey 239 207 9.15 16 7 ## 3 8201 - Amb\\xe9rieu-en-Bugey 14022 13350 24.60 1051 551 ## 4 8213 - Villefranche-sur-Sa\\xf4ne 1627 1592 15.92 117 41 ## 5 8216 - Chamb\\xe9ry 109 120 5.88 8 3 ## 6 8201 - Amb\\xe9rieu-en-Bugey 2570 2328 33.55 175 78 ## P14_MEN NAISD15 DECESD15 P14_LOG P14_RP P14_RSECOCC P14_LOGVAC ## 1 306.00000 13 5 342.73473 306.00000 13.99418 22.740550 ## 2 99.33745 5 1 161.16023 99.33745 47.27625 14.546538 ## 3 6161.06200 222 121 6838.35437 6161.06200 121.64795 555.644416 ## 4 621.05374 15 7 661.76017 621.05374 10.85505 29.851387 ## 5 52.51818 2 2 71.51818 52.51818 10.85714 8.142857 ## 6 1028.00000 21 9 1160.00000 1028.00000 56.00000 76.000000 ## P14_RP_PROP NBMENFISC13 PIMP13 MED13 TP6013 P14_EMPLT P14_EMPLT_SAL ## 1 260.00000 297 NA 22130.00 NA 85.157286 52.191539 ## 2 84.58436 99 NA 23213.00 NA 12.814642 4.946329 ## 3 2769.00170 6034 57.41294 19554.00 15.11508 7452.926728 6743.374287 ## 4 473.32736 617 NA 22387.62 NA 280.569953 206.382233 ## 5 37.65455 47 NA 21871.67 NA 5.945455 3.963636 ## 6 779.00000 1014 62.35178 21650.67 NA 487.730918 372.758450 ## P09_EMPLT P14_POP1564 P14_CHOM1564 P14_ACT1564 ETTOT14 ETAZ14 ETBE14 ETFZ14 ## 1 65.566193 463.00000 33.000000 376.00000 47 9 2 5 ## 2 17.644456 141.62963 9.835391 120.97531 22 1 3 1 ## 3 7551.682296 8962.84216 1059.728437 6681.86216 1316 7 60 131 ## 4 286.611037 1043.12909 66.326127 842.14083 141 14 7 19 ## 5 5.285714 71.34545 7.927273 57.47273 7 0 0 0 ## 6 491.138876 1614.00000 108.000000 1267.00000 203 21 18 21 ## ETGU14 ETGZ14 ETOQ14 ETTEF114 ETTEFP1014 ## 1 25 6 6 9 0 ## 2 14 4 3 2 0 ## 3 892 283 226 385 109 ## 4 85 19 16 27 5 ## 5 5 1 2 0 0 ## 6 114 28 29 38 15 tail(df) ## CODGEO LIBGEO REG DEP ## 36684 97419 Sainte-Rose 04 974 ## 36685 97420 Sainte-Suzanne 04 974 ## 36686 97421 Salazie 04 974 ## 36687 97422 Le Tampon 04 974 ## 36688 97423 Les Trois-Bassins 04 974 ## 36689 97424 Cilaos 04 974 ## ZAU ZE ## 36684 400 - Commune isol\\xe9e hors influence des p\\xf4les 0401 - L&#39;Est ## 36685 112 - Couronne d&#39;un grand p\\xf4le 0402 - Le Nord ## 36686 400 - Commune isol\\xe9e hors influence des p\\xf4les 0401 - L&#39;Est ## 36687 111 - Grand p\\xf4le (plus de 10 000 emplois) 0404 - Le Sud ## 36688 112 - Couronne d&#39;un grand p\\xf4le 0403 - L&#39;Ouest ## 36689 400 - Commune isol\\xe9e hors influence des p\\xf4les 0404 - Le Sud ## P14_POP P09_POP SUPERF NAIS0914 DECE0914 P14_MEN NAISD15 DECESD15 ## 36684 6722 6822 177.60 519 186 2322.000 94 43 ## 36685 22406 22437 57.84 1963 508 7686.912 358 100 ## 36686 7132 7406 103.82 661 235 2420.000 111 46 ## 36687 76796 72658 165.43 6663 2004 29662.460 1339 420 ## 36688 7198 7057 42.58 531 217 2484.887 104 54 ## 36689 5295 5989 84.40 430 186 2016.000 87 38 ## P14_LOG P14_RP P14_RSECOCC P14_LOGVAC P14_RP_PROP NBMENFISC13 PIMP13 ## 36684 2542.478 2322.000 28.58054 191.8979 1799.954 NA NA ## 36685 8328.616 7686.912 50.94097 590.7629 4450.648 NA NA ## 36686 2987.000 2420.000 174.00000 393.0000 1849.000 NA NA ## 36687 32710.091 29662.460 1004.31703 2043.3140 15372.921 NA NA ## 36688 2890.404 2484.887 67.58626 337.9313 1773.765 NA NA ## 36689 2732.690 2016.000 239.56501 477.1253 1522.480 NA NA ## MED13 TP6013 P14_EMPLT P14_EMPLT_SAL P09_EMPLT P14_POP1564 P14_CHOM1564 ## 36684 NA NA 1272.841 920.0617 1269.573 4306.217 1250.516 ## 36685 NA NA 4296.362 3618.1538 4185.015 14821.042 3712.486 ## 36686 NA NA 1519.306 1090.0856 1533.305 4650.000 1369.000 ## 36687 NA NA 16145.620 12486.5465 14807.249 50316.640 12783.137 ## 36688 NA NA 1273.858 994.3469 1202.079 4850.570 1360.617 ## 36689 NA NA 1194.383 993.1546 1314.121 3461.457 1122.361 ## P14_ACT1564 ETTOT14 ETAZ14 ETBE14 ETFZ14 ETGU14 ETGZ14 ETOQ14 ETTEF114 ## 36684 2850.155 414 125 44 31 159 59 55 82 ## 36685 10456.196 1323 136 139 190 694 249 164 267 ## 36686 3108.000 490 148 29 43 214 73 56 95 ## 36687 34446.789 5476 565 398 665 3025 999 823 1032 ## 36688 3524.287 456 42 39 61 223 76 91 59 ## 36689 2415.666 360 49 17 35 193 49 66 65 ## ETTEFP1014 ## 36684 8 ## 36685 66 ## 36686 11 ## 36687 204 ## 36688 20 ## 36689 26 names(df) ## [1] &quot;CODGEO&quot; &quot;LIBGEO&quot; &quot;REG&quot; &quot;DEP&quot; ## [5] &quot;ZAU&quot; &quot;ZE&quot; &quot;P14_POP&quot; &quot;P09_POP&quot; ## [9] &quot;SUPERF&quot; &quot;NAIS0914&quot; &quot;DECE0914&quot; &quot;P14_MEN&quot; ## [13] &quot;NAISD15&quot; &quot;DECESD15&quot; &quot;P14_LOG&quot; &quot;P14_RP&quot; ## [17] &quot;P14_RSECOCC&quot; &quot;P14_LOGVAC&quot; &quot;P14_RP_PROP&quot; &quot;NBMENFISC13&quot; ## [21] &quot;PIMP13&quot; &quot;MED13&quot; &quot;TP6013&quot; &quot;P14_EMPLT&quot; ## [25] &quot;P14_EMPLT_SAL&quot; &quot;P09_EMPLT&quot; &quot;P14_POP1564&quot; &quot;P14_CHOM1564&quot; ## [29] &quot;P14_ACT1564&quot; &quot;ETTOT14&quot; &quot;ETAZ14&quot; &quot;ETBE14&quot; ## [33] &quot;ETFZ14&quot; &quot;ETGU14&quot; &quot;ETGZ14&quot; &quot;ETOQ14&quot; ## [37] &quot;ETTEF114&quot; &quot;ETTEFP1014&quot; class(df) ## [1] &quot;data.frame&quot; typeof(df) ## [1] &quot;list&quot; 11.2 06 - créer, filtrer, sélectionner df &lt;- mutate(df, densite = P14_POP / SUPERF, tx_natal = 1000 * NAISD15 / P14_POP, tx_mort = DECESD15 / P14_POP) selection &lt;- select(df, CODGEO, ZAU, REG, DEP, densite, tx_natal, tx_mort) S0 &lt;- filter(selection, DEP == &quot;62&quot;) S1 &lt;- filter(selection, DEP != &quot;62&quot;) # tout sauf le 62 :( S2 &lt;- filter(selection, DEP %in% c(&quot;59&quot;, &quot;62&quot;)) # L&#39;ancien NPdC :) S3 &lt;- filter(selection, !(DEP %in% c(&quot;59&quot;, &quot;62&quot;))) # Le &quot;sud&quot; de la France S4 &lt;- filter(selection, densite &gt; 100) # l&#39;urbain S5 &lt;- filter(selection, DEP == &quot;62&quot; &amp; densite &gt; 100) # le PdC urbain S6 &lt;- filter(selection, DEP == &quot;62&quot; | densite &gt; 100) # le PdC et l&#39;urbain 11.3 07 - calcul de statistiques df &lt;- df %&gt;% select(1:24) %&gt;% mutate(densite = P14_POP / SUPERF, tx_natal = 1000 * NAISD15 / P14_POP, tx_mort = DECESD15 / P14_POP, ZAU2 = as.factor(substr(ZAU, 1, 3))) # Parce que la variable originale est longue summary(df) ## CODGEO LIBGEO REG DEP ## Length:36689 Length:36689 44 : 5198 62 : 895 ## Class :character Class :character 76 : 4565 02 : 816 ## Mode :character Mode :character 75 : 4505 80 : 782 ## 84 : 4189 76 : 745 ## 32 : 3838 57 : 730 ## 27 : 3831 14 : 707 ## (Other):10563 (Other):32014 ## ZAU ## 112 - Couronne d&#39;un grand p\\xf4le :12297 ## 400 - Commune isol\\xe9e hors influence des p\\xf4les: 7383 ## 300 - Autre commune multipolaris\\xe9e : 7021 ## 120 - Multipolaris\\xe9e des grandes aires urbaines : 3962 ## 111 - Grand p\\xf4le (plus de 10 000 emplois) : 3285 ## 221 - Petit p\\xf4le (de 1 500 \\xe0 5 000 emplois) : 888 ## (Other) : 1853 ## ZE P14_POP P09_POP ## 0061 - Toulouse : 717 Min. : 0 Min. : 0 ## 2307 - Rouen : 501 1st Qu.: 197 1st Qu.: 193 ## 2210 - Amiens : 479 Median : 444 Median : 431 ## 7310 - Tarbes - Lourdes: 455 Mean : 1838 Mean : 1793 ## 2102 - Troyes : 452 3rd Qu.: 1110 3rd Qu.: 1072 ## 2603 - Dijon : 448 Max. :2220445 Max. :2234105 ## (Other) :33637 NA&#39;s :821 NA&#39;s :821 ## SUPERF NAIS0914 DECE0914 P14_MEN ## Min. : 0.04 Min. : 0.0 Min. : 0.00 Min. : 0.0 ## 1st Qu.: 6.44 1st Qu.: 9.0 1st Qu.: 8.00 1st Qu.: 83.8 ## Median : 10.81 Median : 23.0 Median : 17.00 Median : 183.2 ## Mean : 17.64 Mean : 114.4 Mean : 77.35 Mean : 802.0 ## 3rd Qu.: 18.58 3rd Qu.: 60.0 3rd Qu.: 43.00 3rd Qu.: 454.9 ## Max. :18360.00 Max. :150843.0 Max. :69907.00 Max. :1147990.9 ## NA&#39;s :821 NA&#39;s :821 NA&#39;s :821 NA&#39;s :821 ## NAISD15 DECESD15 P14_LOG P14_RP ## Min. : 0.00 Min. : 0.00 Min. : 0.0 Min. : 0.0 ## 1st Qu.: 1.00 1st Qu.: 1.00 1st Qu.: 115.0 1st Qu.: 83.8 ## Median : 4.00 Median : 3.00 Median : 239.1 Median : 183.2 ## Mean : 21.96 Mean : 16.47 Mean : 970.2 Mean : 802.0 ## 3rd Qu.: 11.00 3rd Qu.: 9.00 3rd Qu.: 565.0 3rd Qu.: 454.9 ## Max. :28267.00 Max. :13997.00 Max. :1362181.9 Max. :1147990.9 ## NA&#39;s :821 NA&#39;s :821 NA&#39;s :821 NA&#39;s :821 ## P14_RSECOCC P14_LOGVAC P14_RP_PROP NBMENFISC13 ## Min. : 0.00 Min. : 0.00 Min. : 0.0 Min. : 32.0 ## 1st Qu.: 7.00 1st Qu.: 8.00 1st Qu.: 68.4 1st Qu.: 102.0 ## Median : 19.00 Median : 18.00 Median : 148.0 Median : 205.0 ## Mean : 91.63 Mean : 76.60 Mean : 462.2 Mean : 809.7 ## 3rd Qu.: 49.29 3rd Qu.: 43.75 3rd Qu.: 349.2 3rd Qu.: 484.0 ## Max. :107061.99 Max. :107129.02 Max. :381934.3 Max. :1038789.0 ## NA&#39;s :821 NA&#39;s :821 NA&#39;s :821 NA&#39;s :3793 ## PIMP13 MED13 TP6013 P14_EMPLT ## Min. :24.46 Min. :10021 Min. : 5.00 Min. : 0.0 ## 1st Qu.:50.57 1st Qu.:18452 1st Qu.: 8.73 1st Qu.: 26.0 ## Median :58.40 Median :19844 Median :11.97 Median : 66.8 ## Mean :58.98 Mean :20250 Mean :13.35 Mean : 733.9 ## 3rd Qu.:67.19 3rd Qu.:21563 3rd Qu.:16.80 3rd Qu.: 229.5 ## Max. :89.38 Max. :46251 Max. :44.84 Max. :1801865.8 ## NA&#39;s :31598 NA&#39;s :3793 NA&#39;s :32531 NA&#39;s :821 ## densite tx_natal tx_mort ZAU2 ## Min. : 0.00 Min. : 0.000 Min. :0.0000 112 :12297 ## 1st Qu.: 18.59 1st Qu.: 5.679 1st Qu.:0.0044 400 : 7383 ## Median : 40.35 Median : 9.264 Median :0.0079 300 : 7021 ## Mean : 160.15 Mean : 9.699 Mean :0.0093 120 : 3962 ## 3rd Qu.: 94.57 3rd Qu.: 12.931 3rd Qu.:0.0124 111 : 3285 ## Max. :27126.14 Max. :111.111 Max. :0.1577 221 : 888 ## NA&#39;s :821 NA&#39;s :827 NA&#39;s :827 (Other): 1853 df %&gt;% pull(densite) %&gt;% mean() df %&gt;% pull(densite) %&gt;% sd() df %&gt;% pull(densite) %&gt;% median() df %&gt;% pull(densite) %&gt;% var() On a des NA car les valeurs manquantes sont absorbantes ! df %&gt;% pull(densite) %&gt;% mean(na.rm = T) df %&gt;% pull(densite) %&gt;% sd(na.rm = T) df %&gt;% pull(densite) %&gt;% median(na.rm = T) df %&gt;% pull(densite) %&gt;% var(na.rm = T) df &lt;- df %&gt;% mutate(std_dens = (densite - mean(densite, na.rm = T)) / sd(densite, na.rm = T)) Avantage des variables centrées réduites : on élimine les effets d’unité (d’ordre de grandeur), et on peut donc comparer les distributions de deux variables qui ont des unités différentes (voir module 3) df %&gt;% pull(densite) %&gt;% quantile(na.rm = T) ## 0% 25% 50% 75% 100% ## 0.00000 18.59047 40.35457 94.57430 27126.14108 seq(0, 1, 0.1) # vérifier la séquence qu&#39;on souhaite ## [1] 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0 df %&gt;% pull(densite) %&gt;% quantile(probs = seq(0, 1, 0.1), na.rm = T) ## 0% 10% 20% 30% 40% 50% ## 0.00000 10.03439 15.65357 21.84208 29.76144 40.35457 ## 60% 70% 80% 90% 100% ## 54.82089 77.65199 119.08740 240.40789 27126.14108 t &lt;- table(df$ZAU2) t ## ## 111 112 120 211 212 221 222 300 400 ## 3285 12297 3962 456 815 888 582 7021 7383 100 * prop.table(t) %&gt;% round(digits = 4) ## ## 111 112 120 211 212 221 222 300 400 ## 8.95 33.52 10.80 1.24 2.22 2.42 1.59 19.14 20.12 Deux variables t &lt;- table(df$REG, df$ZAU2) t ## ## 111 112 120 211 212 221 222 300 400 ## 01 17 6 1 0 0 3 0 2 3 ## 02 16 0 4 3 0 2 0 4 5 ## 03 3 3 0 2 0 1 0 0 13 ## 04 10 3 4 2 0 0 0 1 4 ## 11 413 853 3 3 2 0 0 7 0 ## 24 103 734 188 30 72 46 19 375 275 ## 27 140 1299 336 31 122 60 137 737 969 ## 28 216 1126 488 34 104 78 29 762 396 ## 32 481 1505 729 33 18 54 18 711 289 ## 44 322 1721 822 54 102 89 118 1155 815 ## 52 108 535 186 23 44 69 8 386 143 ## 53 89 415 152 47 18 42 1 325 181 ## 75 333 1161 254 51 81 163 81 1002 1379 ## 76 258 1124 333 79 155 123 89 877 1527 ## 84 548 1484 390 43 84 113 47 517 963 ## 93 220 229 69 20 11 32 6 107 269 ## 94 8 99 3 1 2 13 29 53 152 100 * prop.table(t) %&gt;% round(digits = 4) ## ## 111 112 120 211 212 221 222 300 400 ## 01 0.05 0.02 0.00 0.00 0.00 0.01 0.00 0.01 0.01 ## 02 0.04 0.00 0.01 0.01 0.00 0.01 0.00 0.01 0.01 ## 03 0.01 0.01 0.00 0.01 0.00 0.00 0.00 0.00 0.04 ## 04 0.03 0.01 0.01 0.01 0.00 0.00 0.00 0.00 0.01 ## 11 1.13 2.32 0.01 0.01 0.01 0.00 0.00 0.02 0.00 ## 24 0.28 2.00 0.51 0.08 0.20 0.13 0.05 1.02 0.75 ## 27 0.38 3.54 0.92 0.08 0.33 0.16 0.37 2.01 2.64 ## 28 0.59 3.07 1.33 0.09 0.28 0.21 0.08 2.08 1.08 ## 32 1.31 4.10 1.99 0.09 0.05 0.15 0.05 1.94 0.79 ## 44 0.88 4.69 2.24 0.15 0.28 0.24 0.32 3.15 2.22 ## 52 0.29 1.46 0.51 0.06 0.12 0.19 0.02 1.05 0.39 ## 53 0.24 1.13 0.41 0.13 0.05 0.11 0.00 0.89 0.49 ## 75 0.91 3.16 0.69 0.14 0.22 0.44 0.22 2.73 3.76 ## 76 0.70 3.06 0.91 0.22 0.42 0.34 0.24 2.39 4.16 ## 84 1.49 4.04 1.06 0.12 0.23 0.31 0.13 1.41 2.62 ## 93 0.60 0.62 0.19 0.05 0.03 0.09 0.02 0.29 0.73 ## 94 0.02 0.27 0.01 0.00 0.01 0.04 0.08 0.14 0.41 11.4 08 - créer des graphiques ggplot(data = df, aes(x = P14_POP)) + geom_histogram() Ce n’est pas très informatif, mais on peut faire une transformation log pour y voir plus clair ! ggplot(data = df, aes(x = log(P14_POP))) + geom_histogram() Faites maintenant un barplot (qui n’est pas un histogramme !!!!) du nombre de communes par REG. ggplot(data = df, aes(x = REG)) + geom_bar() On va essayer d’y voir plus clair avec le paramètre fill ggplot(data = df, aes(x = REG, fill = REG)) + geom_bar() ggplot(data = df, aes(x = log(P14_POP), y = log(P14_LOGVAC))) + geom_point() ggplot(data = df, aes(x = densite, y = tx_mort, color = REG)) + geom_point() Là encore il faudrait faire une transformation logarithmique, mais tout ça est abordé dans le module 3 ! "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
